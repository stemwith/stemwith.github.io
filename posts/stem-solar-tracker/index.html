<!doctype html><html lang=ko-kr dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Solar Tracker 만들기#
팬(도리도리) & 틸트(끄덕끄덕)가 가능한 2축 서보모터 거치대와 2개의 서보모터를 사용하여 Solar Tracker를 만들어 보자.

단계1: Solar Tracker Frame 3D Printing#









  

  
  

.stl 파일  .gcode 파일
3D 프린팅 후, 조도센서를 설치할 4곳에 1mm 드릴을 이용하여 각각 2개씩 구멍을 뚫는다 (총 8개).


단계2: 조도센서 조립하기#
조도센서 삽입#









  

  
  

조도센서의 다리를 위에서 뚫은 구멍을 통해 넣은 뒤,









  

  
  

뒤쪽에 글루건을 쏘아 고정시킨다. (조도센서는 극성을 구분할 필요가 없으므로, 서로 선이 맞닿지만 않으면 된다.)"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://stemwith.github.io/posts/stem-solar-tracker/"><meta property="og:site_name" content="stemwith"><meta property="og:title" content="STEM, Solar Tracker"><meta property="og:description" content="Solar Tracker 만들기# 팬(도리도리) & 틸트(끄덕끄덕)가 가능한 2축 서보모터 거치대와 2개의 서보모터를 사용하여 Solar Tracker를 만들어 보자.
단계1: Solar Tracker Frame 3D Printing# .stl 파일 .gcode 파일
3D 프린팅 후, 조도센서를 설치할 4곳에 1mm 드릴을 이용하여 각각 2개씩 구멍을 뚫는다 (총 8개).
단계2: 조도센서 조립하기# 조도센서 삽입# 조도센서의 다리를 위에서 뚫은 구멍을 통해 넣은 뒤,
뒤쪽에 글루건을 쏘아 고정시킨다. (조도센서는 극성을 구분할 필요가 없으므로, 서로 선이 맞닿지만 않으면 된다.)"><meta property="og:locale" content="ko_kr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-22T01:41:00+09:00"><meta property="article:modified_time" content="2020-11-22T01:41:00+09:00"><title>STEM, Solar Tracker | stemwith</title><link rel=icon href=/favicon.ico><link rel=manifest href=/manifest.json><link rel=canonical href=https://stemwith.github.io/posts/stem-solar-tracker/><link rel=stylesheet href=/book.min.edacc84919565354dfc39b7e3684e11739048c7cd9356a3036fc1c663b63611d.css integrity="sha256-7azISRlWU1Tfw5t+NoThFzkEjHzZNWowNvwcZjtjYR0=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.48a89e4be341d639de74b0f5b5a0b5ad125313b71f6faa18dd992cd4721b044e.js integrity="sha256-SKieS+NB1jnedLD1taC1rRJTE7cfb6oY3Zks1HIbBE4=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-128DRYVCRT"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-128DRYVCRT")}</script></head><body dir=ltr class="book-kind-page book-type-posts"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav class=book-menu><h2 class=book-brand><a class="flex align-center" href=/><img src=/og_image.png alt=Logo></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><div class=analytics-container><h4>접속 통계</h4><div class=stat-group><span class=stat-label>오늘</span><p class=stat-value id=ga-today-visitors>👤 ...</p></div><div class=stat-group><span class=stat-label>일일 방문자 (2주)</span><div id=ga-daily-chart></div></div><div class=stat-group><span class=stat-label>계</span><ul class=stat-list><li id=ga-total-visitors>- 방문자: ...</li><li id=ga-total-pageviews>- 페이지뷰: ...</li></ul></div></div></nav><script type=text/javascript>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/icons/menu.svg class=book-icon alt=Menu></label><h3>STEM, Solar Tracker</h3><label for=toc-control><img src=/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><ul><li><a href=#solar-tracker-만들기>Solar Tracker 만들기</a></li><li><a href=#태양광-패널의-전압-측정하기>태양광 패널의 전압 측정하기</a></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h1>STEM, Solar Tracker</h1><div class="flex align-center text-small book-post-date"><img src=/icons/calendar.svg class=book-icon alt>
<span>November 22, 2020</span></div><div class=text-small><a href=/categories/science/>Science</a></div><div class="book-post-content markdown-inner"><h3 id=solar-tracker-만들기>Solar Tracker 만들기<a class=anchor href=#solar-tracker-%eb%a7%8c%eb%93%a4%ea%b8%b0>#</a></h3><p>팬(도리도리) & 틸트(끄덕끄덕)가 가능한 2축 서보모터 거치대와 2개의 서보모터를 사용하여 Solar Tracker를 만들어 보자.</p><br><h4 id=단계1-solar-tracker-frame-3d-printing>단계1: Solar Tracker Frame 3D Printing<a class=anchor href=#%eb%8b%a8%ea%b3%841-solar-tracker-frame-3d-printing>#</a></h4><figure class=center style=width:25%><img src=/image/SolarTracker01.png alt=/image/SolarTracker01.png></figure><p><a href=/attach/Sun_Tracker_Gnomon_B.stl>.stl 파일</a> <a href=/attach/Sun_Tracker_Gnomon_B.gcode>.gcode 파일</a></p><p>3D 프린팅 후, 조도센서를 설치할 4곳에 1mm 드릴을 이용하여 각각 2개씩 구멍을 뚫는다 (총 8개).</p><br><br><h4 id=단계2-조도센서-조립하기>단계2: 조도센서 조립하기<a class=anchor href=#%eb%8b%a8%ea%b3%842-%ec%a1%b0%eb%8f%84%ec%84%bc%ec%84%9c-%ec%a1%b0%eb%a6%bd%ed%95%98%ea%b8%b0>#</a></h4><h5 id=조도센서-삽입>조도센서 삽입<a class=anchor href=#%ec%a1%b0%eb%8f%84%ec%84%bc%ec%84%9c-%ec%82%bd%ec%9e%85>#</a></h5><figure class=center style=width:50%><img src=/image/SolarTracker02.png alt=/image/SolarTracker02.png></figure><p>조도센서의 다리를 위에서 뚫은 구멍을 통해 넣은 뒤,</p><figure class=center style=width:50%><img src=/image/SolarTracker03.png alt=/image/SolarTracker03.png></figure><p>뒤쪽에 글루건을 쏘아 고정시킨다. (조도센서는 극성을 구분할 필요가 없으므로, 서로 선이 맞닿지만 않으면 된다.)</p><p>4개의 조도 센서를 위와 같은 방식으로 고정한다.</p><br><h5 id=10kω-저항-연결>10kΩ 저항 연결<a class=anchor href=#10k%cf%89-%ec%a0%80%ed%95%ad-%ec%97%b0%ea%b2%b0>#</a></h5><p>아래 그림과 같이 연결한다.</p><figure class=center style=width:50%><img src=/image/SolarTracker04.png alt=/image/SolarTracker04.png></figure><ul><li>각 조도센서에 연결된 2개의 선 중 하나를 골라 10k 저항을 연결하고 한 뒤, 저항의 다른 쪽 끝을 모두 맞붙여서 GND에 연결한다.</li><li>조도센서의 다른 한쪽 끝을 모두 맞붙여서 ESP32의 3.3V에 연결한다.</li></ul><figure class=center style=width:33%><img src=/image/SolarTracker05.png alt=/image/SolarTracker05.png></figure><ul><li><p>GND와 3.3로 연결되는 선들이 서로 붙지 않도록 절연테이프를 붙여준다.</p><figure class=center style=width:33%><img src=/image/SolarTracker06.png alt=/image/SolarTracker06.png></figure></li><li><p>각 조도센서와 10k 저항의 사이에 ESP32에 연결할 GPIO선을 하나씩 납땜하여 연결한다.</p></li></ul><figure class=center style=width:50%><img src=/image/SolarTracker07.png alt=/image/SolarTracker07.png></figure><ul><li><p>ESP32의 3.3V와 GND에 연결할 선도 함께 납땜하여 연결한다.</p><figure class=center style=width:50%><img src=/image/SolarTracker08.png alt=/image/SolarTracker08.png></figure></li><li><p>선 모양을 잡아 정리한다. (위 사진에는 하트 모양처럼 양 옆으로 선이 나와 있지만, 추후 거치대 장착을 위해서는 아래 사진처럼 모두 오무려주어야 한다.)</p><figure class=center style=width:50%><img src=/image/SolarTracker09.png alt=/image/SolarTracker09.png></figure></li></ul><br><br><h4 id=단계3-2축-서보모터-거치대에-장착하기>단계3: 2축 서보모터 거치대에 장착하기<a class=anchor href=#%eb%8b%a8%ea%b3%843-2%ec%b6%95-%ec%84%9c%eb%b3%b4%eb%aa%a8%ed%84%b0-%ea%b1%b0%ec%b9%98%eb%8c%80%ec%97%90-%ec%9e%a5%ec%b0%a9%ed%95%98%ea%b8%b0>#</a></h4><figure class=center style=width:50%><img src=/image/SolarTracker10.png alt=/image/SolarTracker10.png></figure><br><h5 id=schematic>schematic<a class=anchor href=#schematic>#</a></h5><figure class=center style=width:100%><img src=/image/SolarTracker11.png alt=/image/SolarTracker11.png></figure><br><h5 id=sketch>sketch<a class=anchor href=#sketch>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cm>/************ ESP32 SKETCH FOR SOLAR TRACKER ***************************************
</span></span></span><span class=line><span class=cl><span class=cm>   Author: K. Jun, Lee
</span></span></span><span class=line><span class=cl><span class=cm>   Blog: https://stemwith.github.io         2020-12-04
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>// Use 3.3V for LDR sensor VCC
</span></span></span><span class=line><span class=cl><span class=cm>// Edit your sensor sensitivity: tolh, tolv
</span></span></span><span class=line><span class=cl><span class=cm>// Edit your sensor GPIO pin: ldr_lt, ldr_rt, ldr_ld, ldr_rd
</span></span></span><span class=line><span class=cl><span class=cm>// Edit initial sensor calibration value: avlt_cali, avrt_cali, avld_cali, avrd_cali 
</span></span></span><span class=line><span class=cl><span class=cm>***********************************************************************************/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// for horizontal Servo PWM properties
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>int</span> <span class=n>ledPin_hori</span> <span class=o>=</span> <span class=mi>19</span><span class=p>;</span>       <span class=c1>// corresponds to GPIO 19
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>int</span> <span class=n>ledChannel_hori</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>freq_hori</span> <span class=o>=</span> <span class=mi>50</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>resolution_hori</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// for vertical Servo PWM properties
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>int</span> <span class=n>ledPin_vert</span> <span class=o>=</span> <span class=mi>18</span><span class=p>;</span>       <span class=c1>// corresponds to GPIO 18
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>int</span> <span class=n>ledChannel_vert</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>freq_vert</span> <span class=o>=</span> <span class=mi>50</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>resolution_vert</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>deg_hori</span> <span class=o>=</span> <span class=mi>90</span><span class=p>;</span> <span class=c1>// default horizon
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>deg_vert</span> <span class=o>=</span> <span class=mi>45</span><span class=p>;</span> <span class=c1>// default vertical
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>duty</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// LDR sensor pin
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>ldr_lt</span> <span class=o>=</span> <span class=mi>32</span><span class=p>;</span> <span class=c1>// Left_Top LDR pin
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>ldr_rt</span> <span class=o>=</span> <span class=mi>33</span><span class=p>;</span> <span class=c1>// Right_Top LDR pin
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>ldr_ld</span> <span class=o>=</span> <span class=mi>34</span><span class=p>;</span> <span class=c1>// Left_Down LDR pin
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>ldr_rd</span> <span class=o>=</span> <span class=mi>35</span><span class=p>;</span> <span class=c1>// Right_Down LDR pin
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// LDR sensor value
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>lt</span><span class=p>[</span><span class=mi>10</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>rt</span><span class=p>[</span><span class=mi>10</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>ld</span><span class=p>[</span><span class=mi>10</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>rd</span><span class=p>[</span><span class=mi>10</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Sensitivity (tolerance)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>tolh</span> <span class=o>=</span> <span class=mi>150</span><span class=p>;</span>              <span class=c1>// horizon tolerance
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>tolv</span> <span class=o>=</span> <span class=mi>150</span><span class=p>;</span>              <span class=c1>// vertical tolerance
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// initial sensor correction value 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>avlt_cali</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>       <span class=c1>// 초기값 보정
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>avrt_cali</span> <span class=o>=</span> <span class=mi>350</span><span class=p>;</span>     <span class=c1>// (센서에 밝은 빛을 직접 가하여 최대값을 측정한 뒤 편차를 사용)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>avld_cali</span> <span class=o>=</span> <span class=mi>330</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>avrd_cali</span> <span class=o>=</span> <span class=mi>430</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=mi>115200</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Servo PWM Setup
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nf>ledcSetup</span><span class=p>(</span><span class=n>ledChannel_hori</span><span class=p>,</span> <span class=n>freq_hori</span><span class=p>,</span> <span class=n>resolution_hori</span><span class=p>);</span>  <span class=c1>// PWM CH1, Frequncy 50 Hz, 16bit resolution
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nf>ledcAttachPin</span><span class=p>(</span><span class=n>ledPin_hori</span><span class=p>,</span> <span class=n>ledChannel_hori</span><span class=p>);</span>             <span class=c1>// PWM CH1을 GPIO 19번으로 출력
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nf>ledcSetup</span><span class=p>(</span><span class=n>ledChannel_vert</span><span class=p>,</span> <span class=n>freq_vert</span><span class=p>,</span> <span class=n>resolution_vert</span><span class=p>);</span>  <span class=c1>// PWM CH0, Frequncy 50 Hz, 16bit resolution
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nf>ledcAttachPin</span><span class=p>(</span><span class=n>ledPin_vert</span><span class=p>,</span> <span class=n>ledChannel_vert</span><span class=p>);</span>             <span class=c1>// PWM CH0을 GPIO 19번으로 출력
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>loop</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>avlt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>avrt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>avld</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>avrd</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=mi>10</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>lt</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nf>analogRead</span><span class=p>(</span><span class=n>ldr_lt</span><span class=p>);</span> <span class=c1>// Left Top
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>avlt</span> <span class=o>=</span> <span class=n>avlt</span> <span class=o>+</span> <span class=n>lt</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>avlt_cali</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=n>rt</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nf>analogRead</span><span class=p>(</span><span class=n>ldr_rt</span><span class=p>);</span> <span class=c1>// Right Top
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>avrt</span> <span class=o>=</span> <span class=n>avrt</span> <span class=o>+</span> <span class=n>rt</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>avrt_cali</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ld</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nf>analogRead</span><span class=p>(</span><span class=n>ldr_ld</span><span class=p>);</span> <span class=c1>// Left Down
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>avld</span> <span class=o>=</span> <span class=n>avld</span> <span class=o>+</span> <span class=n>ld</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>avld_cali</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>rd</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nf>analogRead</span><span class=p>(</span><span class=n>ldr_rd</span><span class=p>);</span> <span class=c1>// Right Down
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>avrd</span> <span class=o>=</span> <span class=n>avrd</span> <span class=o>+</span> <span class=n>rd</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>avrd_cali</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>avlt</span> <span class=o>=</span> <span class=n>avlt</span> <span class=o>/</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>avrt</span> <span class=o>=</span> <span class=n>avrt</span> <span class=o>/</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>avld</span> <span class=o>=</span> <span class=n>avld</span> <span class=o>/</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>avrd</span> <span class=o>=</span> <span class=n>avrd</span> <span class=o>/</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>avt</span> <span class=o>=</span> <span class=p>(</span><span class=n>avlt</span> <span class=o>+</span> <span class=n>avrt</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>    <span class=c1>// Average of Top value
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>avd</span> <span class=o>=</span> <span class=p>(</span><span class=n>avld</span> <span class=o>+</span> <span class=n>avrd</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>    <span class=c1>// Average of Down value
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>avl</span> <span class=o>=</span> <span class=p>(</span><span class=n>avlt</span> <span class=o>+</span> <span class=n>avld</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>    <span class=c1>// Average of Left value
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>avr</span> <span class=o>=</span> <span class=p>(</span><span class=n>avrt</span> <span class=o>+</span> <span class=n>avrd</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>    <span class=c1>// Average of Right value.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>dvert</span> <span class=o>=</span> <span class=n>avt</span> <span class=o>-</span> <span class=n>avd</span><span class=p>;</span>      <span class=c1>// Difference Top, Down
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>dhoriz</span> <span class=o>=</span> <span class=n>avl</span> <span class=o>-</span> <span class=n>avr</span><span class=p>;</span>     <span class=c1>// Difference Left, Right
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>println</span><span class=p>(</span><span class=s>&#34;LT</span><span class=se>\t</span><span class=s>RT</span><span class=se>\t</span><span class=s>LD</span><span class=se>\t</span><span class=s>RD</span><span class=se>\t</span><span class=s>av.T</span><span class=se>\t</span><span class=s>av.D</span><span class=se>\t</span><span class=s>av.L</span><span class=se>\t</span><span class=s>av.R</span><span class=se>\t</span><span class=s>d.ver</span><span class=se>\t</span><span class=s>d.hor&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>avlt</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>avrt</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>avld</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>avrd</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>avt</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>avd</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>avl</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>avr</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>dvert</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>&#34;</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>dhoriz</span><span class=p>);</span><span class=n>Serial</span><span class=p>.</span><span class=nf>println</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nf>abs</span><span class=p>(</span><span class=n>dvert</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>tolv</span><span class=p>)</span> <span class=p>{</span>      <span class=c1>// sensitivity
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>avt</span> <span class=o>&lt;</span> <span class=n>avd</span><span class=p>)</span> <span class=p>{</span>            <span class=c1>// 아래쪽 센서가 더 밝으면
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>deg_vert</span> <span class=o>=</span> <span class=o>++</span><span class=n>deg_vert</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>deg_vert</span> <span class=o>&gt;</span> <span class=mi>90</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>deg_vert</span> <span class=o>=</span> <span class=mi>90</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>avt</span> <span class=o>&gt;</span> <span class=n>avd</span><span class=p>)</span> <span class=p>{</span>       <span class=c1>// 윗쪽 센서가 더 밝으면,
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>deg_vert</span> <span class=o>=</span> <span class=o>--</span><span class=n>deg_vert</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>deg_vert</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>deg_vert</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>servoWrite</span><span class=p>(</span><span class=n>ledChannel_vert</span><span class=p>,</span> <span class=n>deg_vert</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nf>abs</span><span class=p>(</span><span class=n>dhoriz</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>tolh</span><span class=p>)</span> <span class=p>{</span>     <span class=c1>// sensitivity
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>avl</span> <span class=o>&gt;</span> <span class=n>avr</span><span class=p>)</span> <span class=p>{</span>            <span class=c1>// 왼쪽 센서가 더 밝으면
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>deg_hori</span> <span class=o>=</span> <span class=o>--</span><span class=n>deg_hori</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>deg_hori</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>deg_hori</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>avl</span> <span class=o>&lt;</span> <span class=n>avr</span><span class=p>)</span> <span class=p>{</span>       <span class=c1>// 오른쪽 센서가 더 밝으면
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>deg_hori</span> <span class=o>=</span> <span class=o>++</span><span class=n>deg_hori</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>deg_hori</span> <span class=o>&gt;</span> <span class=mi>180</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>deg_hori</span> <span class=o>=</span> <span class=mi>180</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>avl</span> <span class=o>==</span> <span class=n>avr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// nothing
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>servoWrite</span><span class=p>(</span><span class=n>ledChannel_hori</span><span class=p>,</span> <span class=n>deg_hori</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>delay</span><span class=p>(</span><span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// deg는 0~180도 까지
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>servoWrite</span><span class=p>(</span><span class=kt>int</span> <span class=n>ch</span><span class=p>,</span> <span class=kt>int</span> <span class=n>deg</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>duty</span> <span class=o>=</span> <span class=nf>map</span><span class=p>(</span><span class=n>deg</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>180</span><span class=p>,</span> <span class=mi>1638</span><span class=p>,</span> <span class=mi>8192</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>ledcWrite</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>duty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>delay</span><span class=p>(</span><span class=mi>50</span><span class=p>);</span>                  <span class=c1>// delay를 줄이면 180도가 완전히 돌지 않음 (최소값 15)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></div><br><br><h3 id=태양광-패널의-전압-측정하기>태양광 패널의 전압 측정하기<a class=anchor href=#%ed%83%9c%ec%96%91%ea%b4%91-%ed%8c%a8%eb%84%90%ec%9d%98-%ec%a0%84%ec%95%95-%ec%b8%a1%ec%a0%95%ed%95%98%ea%b8%b0>#</a></h3><p>MPPT모듈을 만들기 전, 태양광패널에서 만들어지는 전기의 전압을 측정해본다. ESP32의 경우 내부전압 3.3V, 12bit ADC이므로</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=c1>// ESP32 3.3V -&gt; 3.21 , Arduino 5.0V -&gt; 4.89
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>float</span> <span class=n>referenceVolts</span> <span class=o>=</span> <span class=mf>3.21</span><span class=p>;</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=c1>// ESP32 12bit_ADC (4095.0), Arduino 10bit_ADC (1023.0)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>float</span> <span class=n>volts</span> <span class=o>=</span> <span class=p>(</span><span class=n>referenceVolts</span><span class=o>/</span><span class=mf>4095.0</span><span class=p>)</span><span class=o>*</span><span class=n>val</span><span class=o>*</span><span class=mi>1000</span><span class=p>;</span></span></span></code></pre></div><p>를 사용한다.</p><br><h4 id=schematic-1>schematic<a class=anchor href=#schematic-1>#</a></h4><figure class=center style=width:75%><img src=/image/SolarMPPT01.png alt=/image/SolarMPPT01.png></figure><br><h4 id=sketch-1>sketch<a class=anchor href=#sketch-1>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=c1>// ESP32 3.3V -&gt; 3.21 , Arduino 5.0V -&gt; 4.89
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>float</span> <span class=n>referenceVolts</span> <span class=o>=</span> <span class=mf>3.21</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>begin</span><span class=p>(</span><span class=mi>9600</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>loop</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>float</span> <span class=n>volts_sum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;=</span><span class=mi>10</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>val</span> <span class=o>=</span> <span class=nf>analogRead</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>    <span class=c1>// ESP32 12bit_ADC (4095.0), Arduino 10bit_ADC (1023.0)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>float</span> <span class=n>volts</span> <span class=o>=</span> <span class=p>(</span><span class=n>referenceVolts</span><span class=o>/</span><span class=mf>4095.0</span><span class=p>)</span><span class=o>*</span><span class=n>val</span><span class=o>*</span><span class=mi>1000</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=n>volts_sum</span> <span class=o>=</span> <span class=n>volts_sum</span> <span class=o>+</span> <span class=n>volts</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>delay</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>volts_sum</span> <span class=o>=</span> <span class=n>volts_sum</span> <span class=o>/</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;V = &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>print</span><span class=p>(</span><span class=n>volts_sum</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Serial</span><span class=p>.</span><span class=nf>println</span><span class=p>(</span><span class=s>&#34; mV&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>delay</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><br></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a href=/posts/drone-hardware/ class="flex align-center"><img src=/icons/backward.svg class=book-icon alt=Previous title="드론 Part1 기체 조립">
<span>드론 Part1 기체 조립</span></a></div><div><a href=/posts/esp32-%EC%84%9C%EB%B3%B4%EB%AA%A8%ED%84%B0-%EC%A0%9C%EC%96%B4/ class="flex align-center"><span>esp32 서보모터 PWM제어</span>
<img src=/icons/forward.svg class=book-icon alt=Next title="esp32 서보모터 PWM제어"></a></div></div><div class=book-comments></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#solar-tracker-만들기>Solar Tracker 만들기</a></li><li><a href=#태양광-패널의-전압-측정하기>태양광 패널의 전압 측정하기</a></li></ul></li></ul></nav></div></aside></main></body></html>