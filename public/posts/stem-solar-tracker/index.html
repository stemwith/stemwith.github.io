<!DOCTYPE html>
<html lang="ko-kr" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Solar Tracker 만들기#
팬(도리도리) &amp; 틸트(끄덕끄덕)가 가능한 2축 서보모터 거치대와 2개의 서보모터를 사용하여 Solar Tracker를 만들어 보자.

단계1: Solar Tracker Frame 3D Printing#

.stl 파일  .gcode 파일
3D 프린팅 후, 조도센서를 설치할 4곳에 1mm 드릴을 이용하여 각각 2개씩 구멍을 뚫는다 (총 8개).


단계2: 조도센서 조립하기#
조도센서 삽입#

조도센서의 다리를 위에서 뚫은 구멍을 통해 넣은 뒤,

뒤쪽에 글루건을 쏘아 고정시킨다. (조도센서는 극성을 구분할 필요가 없으므로, 서로 선이 맞닿지만 않으면 된다.)">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/posts/stem-solar-tracker/">
  <meta property="og:site_name" content="STEM with">
  <meta property="og:title" content="STEM, Solar Tracker">
  <meta property="og:description" content="Solar Tracker 만들기#팬(도리도리) &amp; 틸트(끄덕끄덕)가 가능한 2축 서보모터 거치대와 2개의 서보모터를 사용하여 Solar Tracker를 만들어 보자.
단계1: Solar Tracker Frame 3D Printing#.stl 파일 .gcode 파일
3D 프린팅 후, 조도센서를 설치할 4곳에 1mm 드릴을 이용하여 각각 2개씩 구멍을 뚫는다 (총 8개).
단계2: 조도센서 조립하기#조도센서 삽입#조도센서의 다리를 위에서 뚫은 구멍을 통해 넣은 뒤,
뒤쪽에 글루건을 쏘아 고정시킨다. (조도센서는 극성을 구분할 필요가 없으므로, 서로 선이 맞닿지만 않으면 된다.)">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-11-22T01:41:00+09:00">
    <meta property="article:modified_time" content="2020-11-22T01:41:00+09:00">


<title>STEM, Solar Tracker | STEM with</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/posts/stem-solar-tracker/">
<link rel="stylesheet" href="/book.min.aeea42fb216bc5e1dbc1c7adf74b0ac79e17602b386834ac6f1c28574b966754.css" integrity="sha256-rupC&#43;yFrxeHbwcet90sKx54XYCs4aDSsbxwoV0uWZ1Q=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.a51994453e5fa3809f7eaaf6143af9de9b67838bac6ba6a9fe161e0559cc2672.js" integrity="sha256-pRmURT5fo4Cffqr2FDr53ptng4usa6ap/hYeBVnMJnI=" crossorigin="anonymous"></script>

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-128DRYVCRT"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-128DRYVCRT');
        }
      </script>


  
</head>
<body dir="ltr" class="book-kind-page book-type-posts">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>STEM with</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>

























</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>STEM, Solar Tracker</h3>

  <label for="toc-control">
    
    <img src="/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#solar-tracker-만들기">Solar Tracker 만들기</a></li>
        <li><a href="#태양광-패널의-전압-측정하기">태양광 패널의 전압 측정하기</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    STEM, Solar Tracker
  </h1>
  
  <div class="flex align-center text-small book-post-date">
    <img src="/icons/calendar.svg" class="book-icon" alt="" />
    <span>November 22, 2020</span>
  </div>



  
  <div class="text-small">
    
      <a href="/categories/science/">Science</a>
  </div>
  

  


  <div class="book-post-content markdown-inner"><h3 id="solar-tracker-만들기">Solar Tracker 만들기<a class="anchor" href="#solar-tracker-%eb%a7%8c%eb%93%a4%ea%b8%b0">#</a></h3>
<p>팬(도리도리) &amp; 틸트(끄덕끄덕)가 가능한 2축 서보모터 거치대와 2개의 서보모터를 사용하여 Solar Tracker를 만들어 보자.</p>
<br>
<h4 id="단계1-solar-tracker-frame-3d-printing">단계1: Solar Tracker Frame 3D Printing<a class="anchor" href="#%eb%8b%a8%ea%b3%841-solar-tracker-frame-3d-printing">#</a></h4>
<p><img src="/image/SolarTracker01.png" alt="" /></p>
<p><a href="/attach/Sun_Tracker_Gnomon_B.stl">.stl 파일</a>  <a href="/attach/Sun_Tracker_Gnomon_B.gcode">.gcode 파일</a></p>
<p>3D 프린팅 후, 조도센서를 설치할 4곳에 1mm 드릴을 이용하여 각각 2개씩 구멍을 뚫는다 (총 8개).</p>
<br>
<br>
<h4 id="단계2-조도센서-조립하기">단계2: 조도센서 조립하기<a class="anchor" href="#%eb%8b%a8%ea%b3%842-%ec%a1%b0%eb%8f%84%ec%84%bc%ec%84%9c-%ec%a1%b0%eb%a6%bd%ed%95%98%ea%b8%b0">#</a></h4>
<h5 id="조도센서-삽입">조도센서 삽입<a class="anchor" href="#%ec%a1%b0%eb%8f%84%ec%84%bc%ec%84%9c-%ec%82%bd%ec%9e%85">#</a></h5>
<p><img src="/image/SolarTracker02.png" alt="" /></p>
<p>조도센서의 다리를 위에서 뚫은 구멍을 통해 넣은 뒤,</p>
<p><img src="/image/SolarTracker03.png" alt="" /></p>
<p>뒤쪽에 글루건을 쏘아 고정시킨다. (조도센서는 극성을 구분할 필요가 없으므로, 서로 선이 맞닿지만 않으면 된다.)</p>
<p>4개의 조도 센서를 위와 같은 방식으로 고정한다.</p>
<br>
<h5 id="10kω-저항-연결">10kΩ 저항 연결<a class="anchor" href="#10k%cf%89-%ec%a0%80%ed%95%ad-%ec%97%b0%ea%b2%b0">#</a></h5>
<p>아래 그림과 같이 연결한다.</p>
<p><img src="/image/SolarTracker04.png" alt="" /></p>
<ul>
<li>각 조도센서에 연결된 2개의 선 중 하나를 골라 10k 저항을 연결하고 한 뒤, 저항의 다른 쪽 끝을 모두 맞붙여서 GND에 연결한다.</li>
<li>조도센서의 다른 한쪽 끝을 모두 맞붙여서 ESP32의 3.3V에 연결한다.</li>
</ul>
<p><img src="/image/SolarTracker05.png" alt="" /></p>
<ul>
<li>
<p>GND와 3.3로 연결되는 선들이 서로 붙지 않도록 절연테이프를 붙여준다.</p>
<p><img src="/image/SolarTracker06.png" alt="" /></p>
</li>
<li>
<p>각 조도센서와 10k 저항의 사이에 ESP32에 연결할 GPIO선을 하나씩 납땜하여 연결한다.</p>
</li>
</ul>
<p><img src="/image/SolarTracker07.png" alt="" /></p>
<ul>
<li>
<p>ESP32의 3.3V와 GND에 연결할 선도 함께 납땜하여 연결한다.</p>
<p><img src="/image/SolarTracker08.png" alt="" /></p>
</li>
<li>
<p>선 모양을 잡아 정리한다. (위 사진에는 하트 모양처럼 양 옆으로 선이 나와 있지만, 추후 거치대 장착을 위해서는 아래 사진처럼 모두 오무려주어야 한다.)</p>
<p><img src="/image/SolarTracker09.png" alt="" /></p>
</li>
</ul>
<br>
<br>
<h4 id="단계3-2축-서보모터-거치대에-장착하기">단계3: 2축 서보모터 거치대에 장착하기<a class="anchor" href="#%eb%8b%a8%ea%b3%843-2%ec%b6%95-%ec%84%9c%eb%b3%b4%eb%aa%a8%ed%84%b0-%ea%b1%b0%ec%b9%98%eb%8c%80%ec%97%90-%ec%9e%a5%ec%b0%a9%ed%95%98%ea%b8%b0">#</a></h4>
<p><img src="/image/SolarTracker10.png" alt="" /></p>
<br>
<h5 id="schematic">schematic<a class="anchor" href="#schematic">#</a></h5>
<p><img src="/image/SolarTracker11.png" alt="" /></p>
<br>
<h5 id="sketch">sketch<a class="anchor" href="#sketch">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">/************ ESP32 SKETCH FOR SOLAR TRACKER ***************************************
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   Author: K. Jun, Lee
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   Blog: https://stemwith.github.io         2020-12-04
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Use 3.3V for LDR sensor VCC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Edit your sensor sensitivity: tolh, tolv
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Edit your sensor GPIO pin: ldr_lt, ldr_rt, ldr_ld, ldr_rd
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Edit initial sensor calibration value: avlt_cali, avrt_cali, avld_cali, avrd_cali 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">***********************************************************************************/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// for horizontal Servo PWM properties
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> ledPin_hori <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>;       <span style="color:#75715e">// corresponds to GPIO 19
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> ledChannel_hori <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> freq_hori <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> resolution_hori <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// for vertical Servo PWM properties
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> ledPin_vert <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>;       <span style="color:#75715e">// corresponds to GPIO 18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> ledChannel_vert <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> freq_vert <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> resolution_vert <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> deg_hori <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>; <span style="color:#75715e">// default horizon
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> deg_vert <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>; <span style="color:#75715e">// default vertical
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> duty;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// LDR sensor pin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> ldr_lt <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>; <span style="color:#75715e">// Left_Top LDR pin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> ldr_rt <span style="color:#f92672">=</span> <span style="color:#ae81ff">33</span>; <span style="color:#75715e">// Right_Top LDR pin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> ldr_ld <span style="color:#f92672">=</span> <span style="color:#ae81ff">34</span>; <span style="color:#75715e">// Left_Down LDR pin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> ldr_rd <span style="color:#f92672">=</span> <span style="color:#ae81ff">35</span>; <span style="color:#75715e">// Right_Down LDR pin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// LDR sensor value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> lt[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> rt[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> ld[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> rd[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Sensitivity (tolerance)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> tolh <span style="color:#f92672">=</span> <span style="color:#ae81ff">150</span>;              <span style="color:#75715e">// horizon tolerance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> tolv <span style="color:#f92672">=</span> <span style="color:#ae81ff">150</span>;              <span style="color:#75715e">// vertical tolerance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// initial sensor correction value 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> avlt_cali <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;       <span style="color:#75715e">// 초기값 보정
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> avrt_cali <span style="color:#f92672">=</span> <span style="color:#ae81ff">350</span>;     <span style="color:#75715e">// (센서에 밝은 빛을 직접 가하여 최대값을 측정한 뒤 편차를 사용)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> avld_cali <span style="color:#f92672">=</span> <span style="color:#ae81ff">330</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> avrd_cali <span style="color:#f92672">=</span> <span style="color:#ae81ff">430</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>() {
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">begin</span>(<span style="color:#ae81ff">115200</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Servo PWM Setup
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">ledcSetup</span>(ledChannel_hori, freq_hori, resolution_hori);  <span style="color:#75715e">// PWM CH1, Frequncy 50 Hz, 16bit resolution
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">ledcAttachPin</span>(ledPin_hori, ledChannel_hori);             <span style="color:#75715e">// PWM CH1을 GPIO 19번으로 출력
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">ledcSetup</span>(ledChannel_vert, freq_vert, resolution_vert);  <span style="color:#75715e">// PWM CH0, Frequncy 50 Hz, 16bit resolution
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">ledcAttachPin</span>(ledPin_vert, ledChannel_vert);             <span style="color:#75715e">// PWM CH0을 GPIO 19번으로 출력
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> avlt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> avrt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> avld <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> avrd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">10</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    lt[i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">analogRead</span>(ldr_lt); <span style="color:#75715e">// Left Top
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    avlt <span style="color:#f92672">=</span> avlt <span style="color:#f92672">+</span> lt[i] <span style="color:#f92672">-</span> avlt_cali;  
</span></span><span style="display:flex;"><span>    rt[i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">analogRead</span>(ldr_rt); <span style="color:#75715e">// Right Top
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    avrt <span style="color:#f92672">=</span> avrt <span style="color:#f92672">+</span> rt[i] <span style="color:#f92672">-</span> avrt_cali;
</span></span><span style="display:flex;"><span>    ld[i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">analogRead</span>(ldr_ld); <span style="color:#75715e">// Left Down
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    avld <span style="color:#f92672">=</span> avld <span style="color:#f92672">+</span> ld[i] <span style="color:#f92672">-</span> avld_cali;
</span></span><span style="display:flex;"><span>    rd[i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">analogRead</span>(ldr_rd); <span style="color:#75715e">// Right Down
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    avrd <span style="color:#f92672">=</span> avrd <span style="color:#f92672">+</span> rd[i] <span style="color:#f92672">-</span> avrd_cali;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  avlt <span style="color:#f92672">=</span> avlt <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>  avrt <span style="color:#f92672">=</span> avrt <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>  avld <span style="color:#f92672">=</span> avld <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>  avrd <span style="color:#f92672">=</span> avrd <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> avt <span style="color:#f92672">=</span> (avlt <span style="color:#f92672">+</span> avrt) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;    <span style="color:#75715e">// Average of Top value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> avd <span style="color:#f92672">=</span> (avld <span style="color:#f92672">+</span> avrd) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;    <span style="color:#75715e">// Average of Down value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> avl <span style="color:#f92672">=</span> (avlt <span style="color:#f92672">+</span> avld) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;    <span style="color:#75715e">// Average of Left value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> avr <span style="color:#f92672">=</span> (avrt <span style="color:#f92672">+</span> avrd) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;    <span style="color:#75715e">// Average of Right value.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> dvert <span style="color:#f92672">=</span> avt <span style="color:#f92672">-</span> avd;      <span style="color:#75715e">// Difference Top, Down
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> dhoriz <span style="color:#f92672">=</span> avl <span style="color:#f92672">-</span> avr;     <span style="color:#75715e">// Difference Left, Right
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;LT</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">RT</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">LD</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">RD</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">av.T</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">av.D</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">av.L</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">av.R</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">d.ver</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">d.hor&#34;</span>);
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">print</span>(avlt);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);Serial.<span style="color:#a6e22e">print</span>(avrt);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">print</span>(avld);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);Serial.<span style="color:#a6e22e">print</span>(avrd);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">print</span>(avt);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);Serial.<span style="color:#a6e22e">print</span>(avd);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">print</span>(avl);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);Serial.<span style="color:#a6e22e">print</span>(avr);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">print</span>(dvert);Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#34;</span>);Serial.<span style="color:#a6e22e">print</span>(dhoriz);Serial.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">abs</span>(dvert) <span style="color:#f92672">&gt;</span> tolv) {      <span style="color:#75715e">// sensitivity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (avt <span style="color:#f92672">&lt;</span> avd) {            <span style="color:#75715e">// 아래쪽 센서가 더 밝으면
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      deg_vert <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>deg_vert;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (deg_vert <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">90</span>) {
</span></span><span style="display:flex;"><span>        deg_vert <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (avt <span style="color:#f92672">&gt;</span> avd) {       <span style="color:#75715e">// 윗쪽 센서가 더 밝으면,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      deg_vert <span style="color:#f92672">=</span> <span style="color:#f92672">--</span>deg_vert;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (deg_vert <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        deg_vert <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">servoWrite</span>(ledChannel_vert, deg_vert);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">abs</span>(dhoriz) <span style="color:#f92672">&gt;</span> tolh) {     <span style="color:#75715e">// sensitivity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (avl <span style="color:#f92672">&gt;</span> avr) {            <span style="color:#75715e">// 왼쪽 센서가 더 밝으면
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      deg_hori <span style="color:#f92672">=</span> <span style="color:#f92672">--</span>deg_hori;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (deg_hori <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        deg_hori <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (avl <span style="color:#f92672">&lt;</span> avr) {       <span style="color:#75715e">// 오른쪽 센서가 더 밝으면
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      deg_hori <span style="color:#f92672">=</span> <span style="color:#f92672">++</span>deg_hori;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (deg_hori <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">180</span>) {
</span></span><span style="display:flex;"><span>        deg_hori <span style="color:#f92672">=</span> <span style="color:#ae81ff">180</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (avl <span style="color:#f92672">==</span> avr) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// nothing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">servoWrite</span>(ledChannel_hori, deg_hori);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">500</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// deg는 0~180도 까지
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">servoWrite</span>(<span style="color:#66d9ef">int</span> ch, <span style="color:#66d9ef">int</span> deg)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    duty <span style="color:#f92672">=</span> <span style="color:#a6e22e">map</span>(deg, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">180</span>, <span style="color:#ae81ff">1638</span>, <span style="color:#ae81ff">8192</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ledcWrite</span>(ch, duty);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">50</span>);                  <span style="color:#75715e">// delay를 줄이면 180도가 완전히 돌지 않음 (최소값 15)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}</span></span></code></pre></div><br>
<br>
<h3 id="태양광-패널의-전압-측정하기">태양광 패널의 전압 측정하기<a class="anchor" href="#%ed%83%9c%ec%96%91%ea%b4%91-%ed%8c%a8%eb%84%90%ec%9d%98-%ec%a0%84%ec%95%95-%ec%b8%a1%ec%a0%95%ed%95%98%ea%b8%b0">#</a></h3>
<p>MPPT모듈을 만들기 전, 태양광패널에서 만들어지는 전기의 전압을 측정해본다. ESP32의 경우 내부전압 3.3V, 12bit ADC이므로</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">// ESP32 3.3V -&gt; 3.21 , Arduino 5.0V -&gt; 4.89
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">float</span> referenceVolts <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.21</span>;</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">// ESP32 12bit_ADC (4095.0), Arduino 10bit_ADC (1023.0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">float</span> volts <span style="color:#f92672">=</span> (referenceVolts<span style="color:#f92672">/</span><span style="color:#ae81ff">4095.0</span>)<span style="color:#f92672">*</span>val<span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>;</span></span></code></pre></div><p>를 사용한다.</p>
<br>
<h4 id="schematic-1">schematic<a class="anchor" href="#schematic-1">#</a></h4>
<p><img src="/image/SolarMPPT01.png" alt="" /></p>
<br>
<h4 id="sketch-1">sketch<a class="anchor" href="#sketch-1">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#75715e">// ESP32 3.3V -&gt; 3.21 , Arduino 5.0V -&gt; 4.89
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">float</span> referenceVolts <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.21</span>; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>() {
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">begin</span>(<span style="color:#ae81ff">9600</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> volts_sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">10</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> val <span style="color:#f92672">=</span> <span style="color:#a6e22e">analogRead</span>(<span style="color:#ae81ff">32</span>);
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ESP32 12bit_ADC (4095.0), Arduino 10bit_ADC (1023.0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">float</span> volts <span style="color:#f92672">=</span> (referenceVolts<span style="color:#f92672">/</span><span style="color:#ae81ff">4095.0</span>)<span style="color:#f92672">*</span>val<span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>; 
</span></span><span style="display:flex;"><span>    volts_sum <span style="color:#f92672">=</span> volts_sum <span style="color:#f92672">+</span> volts;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">100</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  volts_sum <span style="color:#f92672">=</span> volts_sum <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;V = &#34;</span>);
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">print</span>(volts_sum);
</span></span><span style="display:flex;"><span>  Serial.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34; mV&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">100</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><br>
</div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">
  <div>
  
    <a href="/posts/drone-hardware/" class="flex align-center">
      <img src="/icons/backward.svg" class="book-icon" alt="Previous" title="드론 Part1 기체 조립" />
      <span>드론 Part1 기체 조립</span>
    </a>
  
  </div>
  <div>
  
    <a href="/posts/esp32-%EC%84%9C%EB%B3%B4%EB%AA%A8%ED%84%B0-%EC%A0%9C%EC%96%B4/" class="flex align-center">
      <span>esp32 서보모터 PWM제어</span>
      <img src="/icons/forward.svg" class="book-icon" alt="Next" title="esp32 서보모터 PWM제어" />
    </a>
  
  </div>
</div>
 
        
  
  <div class="book-comments">

</div>
  
 
        
        

 
      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    

<aside class="book-toc">
  <div class="book-toc-content">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#solar-tracker-만들기">Solar Tracker 만들기</a></li>
        <li><a href="#태양광-패널의-전압-측정하기">태양광 패널의 전압 측정하기</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </div>
</aside>

 
  </main>

  
</body>
</html>


















