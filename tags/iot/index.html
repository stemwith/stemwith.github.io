<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>태그: iot - Welcome to &quot;stemwith&quot;</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Welcome to &quot;stemwith&quot;"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Welcome to &quot;stemwith&quot;"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="for stem education"><meta property="og:type" content="blog"><meta property="og:title" content="Welcome to &quot;stemwith&quot;"><meta property="og:url" content="http://stemwith.github.io/"><meta property="og:site_name" content="Welcome to &quot;stemwith&quot;"><meta property="og:description" content="for stem education"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="http://stemwith.github.io/img/og_image.png"><meta property="article:author" content="chemidot"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://stemwith.github.io"},"headline":"Welcome to \"stemwith\"","image":["http://stemwith.github.io/img/og_image.png"],"author":{"@type":"Person","name":"chemidot"},"publisher":{"@type":"Organization","name":"Welcome to \"stemwith\"","logo":{"@type":"ImageObject","url":"http://stemwith.github.io/img/logo.svg"}},"description":"for stem education"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai.css"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&amp;family=Roboto" rel="stylesheet"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-151970975-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-151970975-1');</script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/rss2.xml" title="Welcome to "stemwith"" type="application/rss+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Welcome to &quot;stemwith&quot;" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="external nofollow noopener noreferrer" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">태그</a></li><li class="is-active"><a href="#" aria-current="page">iot</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2019-11-19T09:27:53.000Z" title="2019. 11. 19. 오후 5:27:53">2019-11-19</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-11-16T07:08:55.938Z" title="2021. 11. 16. 오후 3:08:55">2021-11-16</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/esp32/">esp32</a></span><span class="level-item">34분안에 읽기 (약 5161 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/19/ESP32-OpenWeatherMap/">esp32 OpenWeatherMap에서 실시간 날씨 정보 받기</a></h1><div class="content"><h3 id="OpenWeatherMap-org"><a href="#OpenWeatherMap-org" class="headerlink" title="OpenWeatherMap.org"></a>OpenWeatherMap.org</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://openweathermap.org/">OpenWeatherMap</a>은 세계 각 지역의 현재 날씨, 예보, 과거 날씨 데이터를 제공하는 사이트입니다. (몇가지 제약이 있긴 하지만) 회원가입을 통해서 API Key를 생성하고 이를 통해 무료로 실시간 날씨 정보를 얻을 수 있습니다.</p>
<br>

<h4 id="Free-Current-weather-and-forecasts-collection"><a href="#Free-Current-weather-and-forecasts-collection" class="headerlink" title="Free Current weather and forecasts collection"></a>Free Current weather and forecasts collection</h4><ul>
<li>60 Calls per minute (no more than)</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://openweathermap.org/current">Current weather API</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://openweathermap.org/forecast5">5 days/3 hour forecast API</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://openweathermap.org/api/weathermaps">Weather maps 1.0</a> </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://openweathermap.org/api/uvi">UV index</a> </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://openweathermap.org/triggers">Weather alerts</a> </li>
<li>Availability 95% </li>
<li>Weather API data update  &lt; 2 hours</li>
<li>Weather maps data update  &lt; 3 hours</li>
<li>API lifetime support :  Current version</li>
<li>Historical weather collection은 모두 Starter 이상(유료)</li>
</ul>
<br>

<h4 id="Current-weather-collections-API-Key-생성"><a href="#Current-weather-collections-API-Key-생성" class="headerlink" title="Current weather collections API Key 생성"></a>Current weather collections API Key 생성</h4><ol>
<li><p>Sign Up을 클릭하여 회원가입을 하고,</p>
<p><img src="/image/owm-api-01.png"></p>
<br>

<p><img src="/image/owm-api-02.png"></p>
<br></li>
<li><p>Sign In을 클릭하여 로그인한 뒤, API Keys를 누릅니다.</p>
<p><img src="/image/owm-api-03.png"></p>
<br>

<p><img src="/image/owm-api-04.png"></p>
<br></li>
<li><p> Default로 지정되어 있는 Key를 복사하거나, 새로운 Key를 생성합니다.</p>
</li>
</ol>
<p>   <img src="/image/owm-api-05.png"></p>
<br>

<ol start="4">
<li><p>API Key를 이용하는 방법은 메인홈페이지 메뉴의 API 탭을 누른뒤, 얻고자 하는 날씨정보(예를 들어 Current weather data)의 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://openweathermap.org/api"><strong>API doc</strong></a>을 참고하세요.</p>
<p><img src="/image/owm-api-06.png"></p>
</li>
<li><p>먼저 인터넷 브라우저를 통해 날씨정보가 어떻게 출력되는지 알아보기위하여 아래 홈페이지 주소에 접속해봅니다. 이때 주소의 끝부분에 있는 YOUR_API_KEY 대신 본인의 API Key를 입력합니다.</p>
</li>
</ol>
<br>

<ul>
<li>서울: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://api.openweathermap.org/data/2.5/weather?q=Seoul,KR&amp;units=metric&amp;APPID=YOUR_API_KEY">https://api.openweathermap.org/data/2.5/weather?q=Seoul,KR&amp;units=metric&amp;APPID=YOUR_API_KEY</a></li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.openweathermap.org/data/2.5/weather?q=Seoul,KR&amp;units=metric&amp;APPID=1bf3d5e1bd2e5934aadd86..........</span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>런던: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://api.openweathermap.org/data/2.5/weather?q=London,GB&amp;units=metric&amp;appid=YOUR_API_KEY">https://api.openweathermap.org/data/2.5/weather?q=London,GB&amp;units=metric&amp;appid=YOUR_API_KEY</a></li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.openweathermap.org/data/2.5/weather?q=London,GB&amp;units=metric&amp;APPID=1bf3d5e1bd2e5934aadd86..........</span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>상하이: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://api.openweathermap.org/data/2.5/weather?q=Shanghai,CN&amp;units=metric&amp;APPID=YOUR_API_KEY">https://api.openweathermap.org/data/2.5/weather?q=Shanghai,CN&amp;units=metric&amp;APPID=YOUR_API_KEY</a></li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.openweathermap.org/data/2.5/weather?q=Shanghai,CN&amp;units=metric&amp;APPID=1bf3d5e1bd2e5934aadd86..........</span><br></pre></td></tr></table></figure>

<br>

<h4 id="브라우저에-출력되는-내용"><a href="#브라우저에-출력되는-내용" class="headerlink" title="브라우저에 출력되는 내용"></a>브라우저에 출력되는 내용</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;coord&quot;</span>:&#123;<span class="attr">&quot;lon&quot;</span>:<span class="number">-0.13</span>,<span class="attr">&quot;lat&quot;</span>:<span class="number">51.51</span>&#125;,<span class="attr">&quot;weather&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">804</span>,<span class="attr">&quot;main&quot;</span>:<span class="string">&quot;Clouds&quot;</span>,<span class="attr">&quot;description&quot;</span>:<span class="string">&quot;overcast clouds&quot;</span>,<span class="attr">&quot;icon&quot;</span>:<span class="string">&quot;04n&quot;</span>&#125;],<span class="attr">&quot;base&quot;</span>:<span class="string">&quot;stations&quot;</span>,<span class="attr">&quot;main&quot;</span>:&#123;<span class="attr">&quot;temp&quot;</span>:<span class="number">277.16</span>,<span class="attr">&quot;pressure&quot;</span>:<span class="number">1007</span>,<span class="attr">&quot;humidity&quot;</span>:<span class="number">86</span>,<span class="attr">&quot;temp_min&quot;</span>:<span class="number">274.82</span>,<span class="attr">&quot;temp_max&quot;</span>:<span class="number">279.26</span>&#125;,<span class="attr">&quot;visibility&quot;</span>:<span class="number">8000</span>,<span class="attr">&quot;wind&quot;</span>:&#123;<span class="attr">&quot;speed&quot;</span>:<span class="number">5.1</span>,<span class="attr">&quot;deg&quot;</span>:<span class="number">90</span>&#125;,<span class="attr">&quot;clouds&quot;</span>:&#123;<span class="attr">&quot;all&quot;</span>:<span class="number">90</span>&#125;,<span class="attr">&quot;dt&quot;</span>:<span class="number">1574300635</span>,<span class="attr">&quot;sys&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;id&quot;</span>:<span class="number">1414</span>,<span class="attr">&quot;country&quot;</span>:<span class="string">&quot;GB&quot;</span>,<span class="attr">&quot;sunrise&quot;</span>:<span class="number">1574321288</span>,<span class="attr">&quot;sunset&quot;</span>:<span class="number">1574352288</span>&#125;,<span class="attr">&quot;timezone&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;id&quot;</span>:<span class="number">2643743</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;London&quot;</span>,<span class="attr">&quot;cod&quot;</span>:<span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure>

<br>

<p>그밖의 도시 및 국가명은 Maps&gt; Weather maps를 클릭하여 표시되는 지도를 통해 확인할 수 있습니다.</p>
<br>

<br>

<h3 id="ESP32에서-사용하는-경우"><a href="#ESP32에서-사용하는-경우" class="headerlink" title="ESP32에서 사용하는 경우"></a>ESP32에서 사용하는 경우</h3><h4 id="wifi-접속-설정"><a href="#wifi-접속-설정" class="headerlink" title="wifi 접속 설정"></a>wifi 접속 설정</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ssid     = <span class="string">&quot;your ssid&quot;</span>;                  <span class="comment">// 연결할 SSID</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* password = <span class="string">&quot;your password&quot;</span>;              <span class="comment">// 연결할 SSID의 비밀번호</span></span><br></pre></td></tr></table></figure>

<ul>
<li>wifi에 접속하기 위한 ssid와 password를 설정</li>
</ul>
<br>

<h4 id="OpenWeatherMap-org-접속-설정"><a href="#OpenWeatherMap-org-접속-설정" class="headerlink" title="OpenWeatherMap.org 접속 설정"></a>OpenWeatherMap.org 접속 설정</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> String endpoint = <span class="string">&quot;https://api.openweathermap.org&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> String ver = <span class="string">&quot;/data/2.5/weather?q=&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> String city = <span class="string">&quot;Shanghai,CN&quot;</span>;                 <span class="comment">// City,Country (띄어쓰기 금지)</span></span><br><span class="line"><span class="keyword">const</span> String appid = <span class="string">&quot;&amp;units=metric&amp;APPID=&quot;</span>;       <span class="comment">// Units: metric</span></span><br><span class="line"><span class="keyword">const</span> String key = <span class="string">&quot;1bf3d5e1bd2e5934aadd86..........&quot;</span>;    <span class="comment">// API Key</span></span><br></pre></td></tr></table></figure>

<ul>
<li>날씨 데이터를 받아올 도시, 국가를 지정 (Shanghai,CN)  (※주의: <strong>Shanghai,CN</strong> 사이에 <strong>띄어쓰기를 하면 안됨</strong>)</li>
<li>key 변수에 본의 API Key를 입력</li>
</ul>
<br>

<h4 id="sketch"><a href="#sketch" class="headerlink" title="sketch"></a>sketch</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;HTTPClient.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ssid     = <span class="string">&quot;your ssid&quot;</span>;                  <span class="comment">// 연결할 SSID</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* password = <span class="string">&quot;your password&quot;</span>;              <span class="comment">// 연결할 SSID의 비밀번호</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// OpenWeatherMap.org: Shanghai,CN</span></span><br><span class="line"><span class="keyword">const</span> String endpoint = <span class="string">&quot;https://api.openweathermap.org&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> String ver = <span class="string">&quot;/data/2.5/weather?q=&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> String city = <span class="string">&quot;Shanghai,CN&quot;</span>;                 <span class="comment">// City,Country (띄어쓰기 금지)</span></span><br><span class="line"><span class="keyword">const</span> String appid = <span class="string">&quot;&amp;units=metric&amp;APPID=&quot;</span>;       <span class="comment">// Units: metric</span></span><br><span class="line"><span class="keyword">const</span> String key = <span class="string">&quot;1bf3d5e1bd2e5934aadd86..........&quot;</span>;    <span class="comment">// API Key</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    WiFi.<span class="built_in">begin</span>(ssid, password);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 와이파이 연결</span></span><br><span class="line">    <span class="keyword">while</span> (WiFi.<span class="built_in">status</span>() != WL_CONNECTED) &#123;</span><br><span class="line">      <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;Connecting to WiFi..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Connected to the WiFi network&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 연결 여부 로그 출력</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ((WiFi.<span class="built_in">status</span>() == WL_CONNECTED)) &#123;    <span class="comment">// Check the current connection status</span></span><br><span class="line"> </span><br><span class="line">    HTTPClient http;</span><br><span class="line"> </span><br><span class="line">    http.<span class="built_in">begin</span>(endpoint + ver + city + appid + key); <span class="comment">// Specify the URL</span></span><br><span class="line">    <span class="keyword">int</span> httpCode = http.<span class="built_in">GET</span>();                       <span class="comment">// Make the request</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;                              <span class="comment">// Check for the returning code</span></span><br><span class="line"> </span><br><span class="line">        String json = http.<span class="built_in">getString</span>();         <span class="comment">// get JSON format data</span></span><br><span class="line">        Serial.<span class="built_in">println</span>(httpCode);</span><br><span class="line">        Serial.<span class="built_in">println</span>(json);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;Error on HTTP request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    http.<span class="built_in">end</span>();                                     <span class="comment">// Free the resources</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">30000</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="출력-DATA"><a href="#출력-DATA" class="headerlink" title="출력 DATA"></a>출력 DATA</h4><p>출력 데이터는 <strong>JSON</strong>(JavaScript Object Notation)을 기반으로 합니다. JSON은 프로그래밍 언어에 관계없이 데이터를 생성하고 읽을 수 있도록 만들어졌으며, 이를 통해 상호간에 보다 쉽게 데이터를 교환이 가능한 텍스트 기반의 데이터 교환 방식입니다. OpenWeatherMap에서도 이 방식을 사용하여 날씨 데이터를 생성하여 출력하고 있으며, 출력 데이터의 형태는 아래와 같습니다.</p>
<blockquote>
<p>스케치 맨 아래라인의 delay 명령으로 인해 10초마다 1번씩 data를 출력합니다. 단, OpenWeatherMap free service의 update time이 2시간 이하로 되어 있으므로, 자료 갱신이 매 출력시마다 진행되지는 않습니다.</p>
</blockquote>
<p><img src="/image/owm-01.png"></p>
<br>

<p>Firefox 등의 몇몇 인터넷 브라우저에서는 JSON 데이터를 보다 직관적으로 이해할 수 있도록 계층별로 나누어 출력해주기도 합니다.</p>
<p><img src="/image/owm-02.png"></p>
<br>

<br>

<h3 id="JSON-Parsing"><a href="#JSON-Parsing" class="headerlink" title="JSON Parsing"></a>JSON Parsing</h3><p>위와 같이 복잡한 형태로 출력되는 날씨 데이터 중에서 필요한 날씨 정보를 추출하기 위하여 JSON (JavaScript Object Notation) 파싱 과정을 거쳐야 하는데요. 이를 위해 아두이노 IDE에서 Json 파싱을 위한 라이브러리를 설치하여야 합니다.</p>
<br>

<h4 id="라이브러리-설치"><a href="#라이브러리-설치" class="headerlink" title="라이브러리 설치"></a>라이브러리 설치</h4><p>ArduinoJson (by Benoit Blanchon) 라이브러리 (version 6)를 설치합니다.</p>
<p><strong>스케치</strong>&gt; <strong>라이브러리 포함하기</strong>&gt; <strong>라이브러리 관리</strong></p>
<p><img src="/image/json-01.png"></p>
<br>

<p><img src="/image/json-02.png"></p>
<br>

<h4 id="Memory-pool-크기-계산"><a href="#Memory-pool-크기-계산" class="headerlink" title="Memory pool 크기 계산"></a>Memory pool 크기 계산</h4><ol>
<li>JSON 파싱에 사용할 배열의 크기를 계산하여 메모리를 확보합니다. 이를 위해 샘플로 사용할 JSON데이터가 필요하므로, 먼저 웹브라우저에서 OpenWeatherMap에 접속한 뒤,</li>
</ol>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.openweathermap.org/data/2.5/weather?q=Shanghai,CN&amp;units=metric&amp;APPID=1bf3d5e1bd2e5934aadd86..........</span><br></pre></td></tr></table></figure>

<br>

<ol start="2">
<li>출력되는 JSON 데이터를 드래그하여 복사합니다.</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;coord&quot;</span>:&#123;<span class="attr">&quot;lon&quot;</span>:<span class="number">-0.13</span>,<span class="attr">&quot;lat&quot;</span>:<span class="number">51.51</span>&#125;,<span class="attr">&quot;weather&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">804</span>,<span class="attr">&quot;main&quot;</span>:<span class="string">&quot;Clouds&quot;</span>,<span class="attr">&quot;description&quot;</span>:<span class="string">&quot;overcast clouds&quot;</span>,<span class="attr">&quot;icon&quot;</span>:<span class="string">&quot;04n&quot;</span>&#125;],<span class="attr">&quot;base&quot;</span>:<span class="string">&quot;stations&quot;</span>,<span class="attr">&quot;main&quot;</span>:&#123;<span class="attr">&quot;temp&quot;</span>:<span class="number">277.16</span>,<span class="attr">&quot;pressure&quot;</span>:<span class="number">1007</span>,<span class="attr">&quot;humidity&quot;</span>:<span class="number">86</span>,<span class="attr">&quot;temp_min&quot;</span>:<span class="number">274.82</span>,<span class="attr">&quot;temp_max&quot;</span>:<span class="number">279.26</span>&#125;,<span class="attr">&quot;visibility&quot;</span>:<span class="number">8000</span>,<span class="attr">&quot;wind&quot;</span>:&#123;<span class="attr">&quot;speed&quot;</span>:<span class="number">5.1</span>,<span class="attr">&quot;deg&quot;</span>:<span class="number">90</span>&#125;,<span class="attr">&quot;clouds&quot;</span>:&#123;<span class="attr">&quot;all&quot;</span>:<span class="number">90</span>&#125;,<span class="attr">&quot;dt&quot;</span>:<span class="number">1574300635</span>,<span class="attr">&quot;sys&quot;</span>:&#123;<span class="attr">&quot;type&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;id&quot;</span>:<span class="number">1414</span>,<span class="attr">&quot;country&quot;</span>:<span class="string">&quot;GB&quot;</span>,<span class="attr">&quot;sunrise&quot;</span>:<span class="number">1574321288</span>,<span class="attr">&quot;sunset&quot;</span>:<span class="number">1574352288</span>&#125;,<span class="attr">&quot;timezone&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;id&quot;</span>:<span class="number">2643743</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;London&quot;</span>,<span class="attr">&quot;cod&quot;</span>:<span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure>

<br>

<ol start="3">
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://arduinojson.org/assistant">https://arduinojson.org/assistant</a> 에 접속한 뒤, <strong>Input</strong>란에 있는 내용을 모두 지우고 복사한 JSON데이터를 붙여넣기하면, Memory pool size가 자동으로 계산됩니다.</li>
</ol>
<p><img src="/image/owm-04.png"></p>
<br>

<ol start="4">
<li>Memory pool size의 Expression부분을 드래그하여 복사하고, Additional bytes for strings dubplucation 부분의 숫자를 이용하여 스케치에서 다음의 형식으로 변수를 생성합니다.</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">size_t</span> capacity = <span class="built_in">JSON_ARRAY_SIZE</span>(<span class="number">1</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">1</span>) + <span class="number">2</span>*<span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">2</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">4</span>) + <span class="number">2</span>*<span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">5</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">13</span>) + <span class="number">240</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>실제로는 아래 Parsing Program에 이미 변수가 설정되어 있으므로, 이 과정은 수행하지 않아도 됩니다.</p>
</blockquote>
<br>

<h4 id="Parsing-program"><a href="#Parsing-program" class="headerlink" title="Parsing program"></a>Parsing program</h4><ol>
<li>Memory pool size가 출력된 화면의 아래쪽에 Parsing program도 함께 출력됩니다.</li>
</ol>
<p><img src="/image/owm-05.png"></p>
<br>

<ol start="2">
<li>우선 Parsing Program 전체를 복사한 뒤, 스케치의 void loop() 부분에 붙여넣기 합니다.</li>
</ol>
<br>

<ol start="3">
<li>밑줄친 부분의 json 변수가 나타나 있는 라인을 모두 지우고 </li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* json = <span class="string">&quot;&#123;\&quot;coord\&quot;:&#123;\&quot;lon\&quot;:121.49,\&quot;lat\&quot;:31.23&#125;,\&quot;weather\&quot;:[&#123;\&quot;id\&quot;:804,\&quot;main\&quot;:\&quot;Clouds\&quot;,\&quot;description\&quot;:\&quot;overcast clouds\&quot;,\&quot;icon\&quot;:\&quot;04d\&quot;&#125;],\&quot;base\&quot;:\&quot;stations\&quot;,\&quot;main\&quot;:&#123;\&quot;temp\&quot;:293.02,\&quot;pressure\&quot;:1027,\&quot;humidity\&quot;:55,\&quot;temp_min\&quot;:289.82,\&quot;temp_max\&quot;:298.71&#125;,\&quot;visibility\&quot;:10000,\&quot;wind\&quot;:&#123;\&quot;speed\&quot;:3,\&quot;deg\&quot;:60&#125;,\&quot;clouds\&quot;:&#123;\&quot;all\&quot;:94&#125;,\&quot;dt\&quot;:1574303919,\&quot;sys\&quot;:&#123;\&quot;type\&quot;:1,\&quot;id\&quot;:9659,\&quot;country\&quot;:\&quot;CN\&quot;,\&quot;sunrise\&quot;:1574288762,\&quot;sunset\&quot;:1574326426&#125;,\&quot;timezone\&quot;:28800,\&quot;id\&quot;:1796236,\&quot;name\&quot;:\&quot;Shanghai\&quot;,\&quot;cod\&quot;:200&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<br>

<ol start="4">
<li> OpenWeatherMap에서 실시간으로 받는 String 형식의 데이터 변수로 바꿔줍니다.</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String json = http.<span class="built_in">getString</span>();</span><br></pre></td></tr></table></figure>

<br>

<ol start="5">
<li>Timezone 반영을 위하여, 붙여넣기 한 Parsing program의 아래 부분에 아래 내용을 추가합니다.</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dt = dt + timezone;                     <span class="comment">// for GMT+8 -&gt; +28800, for GMT+9 -&gt; +32400</span></span><br><span class="line">sys_sunrise = sys_sunrise + timezone;</span><br><span class="line">sys_sunset = sys_sunset + timezone;</span><br></pre></td></tr></table></figure>

<br>

<ol start="6">
<li><p>UNIX Timestamp로 표기되는 시간을 일반적인 날짜, 시간으로 표기되도록 변환해줍니다. 이를 위해서 timelib.h 파일을 이용해야하는데, 이 파일은 Time 라이브러리(by Michael Margolis)에 포함되어 있지요. 그러므로 라이브러리 매니저를 통해 Time라이브러리를 찾아 설치해줍니다.</p>
<p><img src="/image/owm-10.png"></p>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">year</span>(dt), <span class="built_in">month</span>(dt), <span class="built_in">day</span>(dt), <span class="built_in">hour</span>(dt), <span class="built_in">minute</span>(dt), <span class="built_in">second</span>(dt), <span class="built_in">weekday</span>(dt));</span><br></pre></td></tr></table></figure>

<p>​        위의 스케치를 통해서 UTC를 YYYY.MM.DD HH:MM:SS(요일) 형태의 날짜를 변환하며, printf문을 통해 출력할 수 있습니다.</p>
<br>

<h4 id="Data-출력에-사용한-variables"><a href="#Data-출력에-사용한-variables" class="headerlink" title="Data 출력에 사용한 variables"></a>Data 출력에 사용한 variables</h4><p>JSON 형식의 데이터를 파싱할때 사용한 변수들입니다.</p>
<table>
<thead>
<tr>
<th>내용</th>
<th>형식</th>
<th>변수</th>
<th>unit</th>
</tr>
</thead>
<tbody><tr>
<td>UNIX Time(UTC)</td>
<td>long</td>
<td>dt</td>
<td></td>
</tr>
<tr>
<td>Weather ID</td>
<td>int</td>
<td>weather_0_id</td>
<td></td>
</tr>
<tr>
<td>Weather Main</td>
<td>const char*</td>
<td>weather_0_main</td>
<td></td>
</tr>
<tr>
<td>Weather Description</td>
<td>const char*</td>
<td>weather_0_description</td>
<td></td>
</tr>
<tr>
<td>Weather Icon ID</td>
<td>const char*</td>
<td>weather_0_icon</td>
<td></td>
</tr>
<tr>
<td>Temperature</td>
<td>float</td>
<td>main_temp</td>
<td>℃</td>
</tr>
<tr>
<td>Temperature Max.</td>
<td>float</td>
<td>main_temp_max</td>
<td>℃</td>
</tr>
<tr>
<td>Temperature Min.</td>
<td>float</td>
<td>main_temp_min</td>
<td>℃</td>
</tr>
<tr>
<td>Pressure</td>
<td>int</td>
<td>main_pressure</td>
<td>hPa</td>
</tr>
<tr>
<td>Humidity</td>
<td>int</td>
<td>main_humidity</td>
<td>%</td>
</tr>
<tr>
<td>Visibility</td>
<td>int</td>
<td>visibility</td>
<td>m</td>
</tr>
<tr>
<td>Wind Speed</td>
<td>int</td>
<td>wind_speed</td>
<td>m/s</td>
</tr>
<tr>
<td>Wind Degree</td>
<td>int</td>
<td>wind_deg</td>
<td>º</td>
</tr>
<tr>
<td>Clouds</td>
<td>int</td>
<td>clouds_all</td>
<td></td>
</tr>
<tr>
<td>Sunrise</td>
<td>long</td>
<td>sys_sunrise</td>
<td></td>
</tr>
<tr>
<td>Sunset</td>
<td>long</td>
<td>sys_sunset</td>
<td></td>
</tr>
<tr>
<td>City ID</td>
<td>long</td>
<td>id</td>
<td></td>
</tr>
<tr>
<td>City name</td>
<td>const char*</td>
<td>name</td>
<td></td>
</tr>
<tr>
<td>Country</td>
<td>const char*</td>
<td>sys_country</td>
<td></td>
</tr>
<tr>
<td>Longitude</td>
<td>float</td>
<td>coord_lon</td>
<td>º</td>
</tr>
<tr>
<td>Latitude</td>
<td>float</td>
<td>coord_lat</td>
<td>º</td>
</tr>
<tr>
<td>GMT</td>
<td>int</td>
<td>timezone  (※timezone/3600)</td>
<td>hour</td>
</tr>
<tr>
<td></td>
<td>int</td>
<td>sys_type</td>
<td></td>
</tr>
<tr>
<td></td>
<td>int</td>
<td>sys_id</td>
<td></td>
</tr>
<tr>
<td>Base</td>
<td>const char*</td>
<td>base</td>
<td></td>
</tr>
<tr>
<td>COD</td>
<td>int</td>
<td>cod</td>
<td></td>
</tr>
</tbody></table>
<br>

<br>

<h4 id="sketch-전체"><a href="#sketch-전체" class="headerlink" title="sketch: 전체"></a>sketch: 전체</h4><p>위의 과정을 통해 만들진 부분 스케치를 병합하여 JSON 파싱을 위한 전체 스케치를 구성해봅니다.</p>
<blockquote>
<p>ArduinoJson 라이브러리의 경우 version 5와 6의 사용 문법이 조금 다릅니다. 현재 Arduino IDE에서 라이브러리 추가과정을 통해 다운로드 받을 수 있는 최신 라이브러리 버전이 ArduinoJson 6이므로, 이에 맞게 작성하여야합니다. (기존의 ArduinoJson 5에 맞게 작성된 스케치는 컴파일이 되지 않으므로, <a target="_blank" rel="external nofollow noopener noreferrer" href="https://arduinojson.org/v6/doc/upgrade/">Migrating from version 5 to 6</a> 문서를 참고하여 스케치를 변경해야 합니다.)</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;HTTPClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;TimeLib.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ssid     = <span class="string">&quot;your ssid&quot;</span>;                  <span class="comment">// 연결할 SSID</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* password = <span class="string">&quot;your password&quot;</span>;              <span class="comment">// 연결할 SSID의 비밀번호</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> String endpoint = <span class="string">&quot;https://api.openweathermap.org&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> String ver = <span class="string">&quot;/data/2.5/weather?q=&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> String city = <span class="string">&quot;Shanghai,CN&quot;</span>;                 <span class="comment">// City,Country (띄어쓰기 금지)</span></span><br><span class="line"><span class="keyword">const</span> String appid = <span class="string">&quot;&amp;units=metric&amp;APPID=&quot;</span>;       <span class="comment">// Units: metric</span></span><br><span class="line"><span class="keyword">const</span> String key = <span class="string">&quot;1bf3d5e1bd2e5934aadd86..........&quot;</span>;    <span class="comment">// API Key</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> offset_days = <span class="number">3</span>;     <span class="comment">// 3 days for convert unix timestamp to datetime</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  WiFi.<span class="built_in">begin</span>(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.<span class="built_in">status</span>() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Connecting to WiFi..&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;Connected to the WiFi network&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ((WiFi.<span class="built_in">status</span>() == WL_CONNECTED)) &#123;      <span class="comment">// Check the current connection status</span></span><br><span class="line"> </span><br><span class="line">    HTTPClient http;</span><br><span class="line"> </span><br><span class="line">    http.<span class="built_in">begin</span>(endpoint + ver + city + appid + key); <span class="comment">// Specify the URL</span></span><br><span class="line">    <span class="keyword">int</span> httpCode = http.<span class="built_in">GET</span>();                       <span class="comment">// Make the request</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;                              <span class="comment">// Check for the returning code</span></span><br><span class="line">      <span class="comment">// 데이터 파싱</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">size_t</span> capacity = <span class="built_in">JSON_ARRAY_SIZE</span>(<span class="number">1</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">1</span>) + <span class="number">2</span>*<span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">2</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">4</span>) + <span class="number">2</span>*<span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">5</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">13</span>) + <span class="number">270</span>;</span><br><span class="line">      <span class="function">DynamicJsonDocument <span class="title">doc</span><span class="params">(capacity)</span></span>;</span><br><span class="line"></span><br><span class="line">      String json = http.<span class="built_in">getString</span>();                <span class="comment">// get JSON format data</span></span><br><span class="line"></span><br><span class="line">      <span class="built_in">deserializeJson</span>(doc, json);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">float</span> coord_lon = doc[<span class="string">&quot;coord&quot;</span>][<span class="string">&quot;lon&quot;</span>]; <span class="comment">// 121.49</span></span><br><span class="line">      <span class="keyword">float</span> coord_lat = doc[<span class="string">&quot;coord&quot;</span>][<span class="string">&quot;lat&quot;</span>]; <span class="comment">// 31.23</span></span><br><span class="line"></span><br><span class="line">      JsonObject weather_0 = doc[<span class="string">&quot;weather&quot;</span>][<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">int</span> weather_0_id = weather_0[<span class="string">&quot;id&quot;</span>]; <span class="comment">// 804</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* weather_0_main = weather_0[<span class="string">&quot;main&quot;</span>]; <span class="comment">// &quot;Clouds&quot;</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* weather_0_description = weather_0[<span class="string">&quot;description&quot;</span>]; <span class="comment">// &quot;overcast clouds&quot;</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* weather_0_icon = weather_0[<span class="string">&quot;icon&quot;</span>]; <span class="comment">// &quot;04d&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      JsonObject weather_1 = weather[1];</span></span><br><span class="line"><span class="comment">      int weather_1_id = weather_1[&quot;id&quot;]; // 701</span></span><br><span class="line"><span class="comment">      const char* weather_1_main = weather_1[&quot;main&quot;]; // &quot;Mist&quot;</span></span><br><span class="line"><span class="comment">      const char* weather_1_description = weather_1[&quot;description&quot;]; // &quot;mist&quot;</span></span><br><span class="line"><span class="comment">      const char* weather_1_icon = weather_1[&quot;icon&quot;]; // &quot;50n&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      JsonObject weather_2 = weather[2];</span></span><br><span class="line"><span class="comment">      int weather_2_id = weather_2[&quot;id&quot;]; // 741</span></span><br><span class="line"><span class="comment">      const char* weather_2_main = weather_2[&quot;main&quot;]; // &quot;Fog&quot;</span></span><br><span class="line"><span class="comment">      const char* weather_2_description = weather_2[&quot;description&quot;]; // &quot;fog&quot;</span></span><br><span class="line"><span class="comment">      const char* weather_2_icon = weather_2[&quot;icon&quot;]; // &quot;50n&quot;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* base = doc[<span class="string">&quot;base&quot;</span>]; <span class="comment">// &quot;stations&quot;</span></span><br><span class="line"></span><br><span class="line">      JsonObject main = doc[<span class="string">&quot;main&quot;</span>];</span><br><span class="line">      <span class="keyword">float</span> main_temp = main[<span class="string">&quot;temp&quot;</span>]; <span class="comment">// 293.02</span></span><br><span class="line">      <span class="keyword">int</span> main_pressure = main[<span class="string">&quot;pressure&quot;</span>]; <span class="comment">// 1027</span></span><br><span class="line">      <span class="keyword">int</span> main_humidity = main[<span class="string">&quot;humidity&quot;</span>]; <span class="comment">// 55</span></span><br><span class="line">      <span class="keyword">float</span> main_temp_min = main[<span class="string">&quot;temp_min&quot;</span>]; <span class="comment">// 289.82</span></span><br><span class="line">      <span class="keyword">float</span> main_temp_max = main[<span class="string">&quot;temp_max&quot;</span>]; <span class="comment">// 298.71</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> visibility = doc[<span class="string">&quot;visibility&quot;</span>]; <span class="comment">// 10000</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> wind_speed = doc[<span class="string">&quot;wind&quot;</span>][<span class="string">&quot;speed&quot;</span>]; <span class="comment">// 3</span></span><br><span class="line">      <span class="keyword">int</span> wind_deg = doc[<span class="string">&quot;wind&quot;</span>][<span class="string">&quot;deg&quot;</span>]; <span class="comment">// 60</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> clouds_all = doc[<span class="string">&quot;clouds&quot;</span>][<span class="string">&quot;all&quot;</span>]; <span class="comment">// 94</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">long</span> dt = doc[<span class="string">&quot;dt&quot;</span>]; <span class="comment">// 1574303919</span></span><br><span class="line"></span><br><span class="line">      JsonObject sys = doc[<span class="string">&quot;sys&quot;</span>];</span><br><span class="line">      <span class="keyword">int</span> sys_type = sys[<span class="string">&quot;type&quot;</span>]; <span class="comment">// 1</span></span><br><span class="line">      <span class="keyword">int</span> sys_id = sys[<span class="string">&quot;id&quot;</span>]; <span class="comment">// 9659</span></span><br><span class="line">      <span class="comment">//float sys_message = sys[&quot;message&quot;]; // Internal parameter (0.0226)</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* sys_country = sys[<span class="string">&quot;country&quot;</span>]; <span class="comment">// &quot;CN&quot;</span></span><br><span class="line">      <span class="keyword">long</span> sys_sunrise = sys[<span class="string">&quot;sunrise&quot;</span>]; <span class="comment">// 1574288762</span></span><br><span class="line">      <span class="keyword">long</span> sys_sunset = sys[<span class="string">&quot;sunset&quot;</span>]; <span class="comment">// 1574326426</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> timezone = doc[<span class="string">&quot;timezone&quot;</span>]; <span class="comment">// 28800</span></span><br><span class="line">      <span class="keyword">long</span> id = doc[<span class="string">&quot;id&quot;</span>]; <span class="comment">// 1796236</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* name = doc[<span class="string">&quot;name&quot;</span>]; <span class="comment">// &quot;Shanghai&quot;</span></span><br><span class="line">      <span class="keyword">int</span> cod = doc[<span class="string">&quot;cod&quot;</span>]; <span class="comment">// 200</span></span><br><span class="line"></span><br><span class="line">      dt = dt + timezone;                <span class="comment">// for GMT+8 -&gt; +28800, for GMT+9 -&gt; +32400</span></span><br><span class="line">      sys_sunrise = sys_sunrise + timezone;</span><br><span class="line">      sys_sunset = sys_sunset + timezone;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//int main_sea_level = main[&quot;sea_level&quot;]; // Atmospheric pressure hPa on the sea level</span></span><br><span class="line">      <span class="comment">//int main_grnd_level = main[&quot;grnd_level&quot;]; // Atmospheric pressure hPa on the ground level     </span></span><br><span class="line">      <span class="comment">//int rain_1h = doc[&quot;rain&quot;][&quot;1h&quot;]; // Rain volume for the last 1 hour, mm</span></span><br><span class="line">      <span class="comment">//int rain_3h = doc[&quot;rain&quot;][&quot;3h&quot;]; // Rain volume for the last 3 hour, mm</span></span><br><span class="line">      <span class="comment">//int snow_1h = doc[&quot;snow&quot;][&quot;1h&quot;]; // Snow volume for the last 1 hour, mm</span></span><br><span class="line">      <span class="comment">//int snow_3h = doc[&quot;snow&quot;][&quot;3h&quot;]; // Snow volume for the last 3 hour, mm</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//데이터 출력</span></span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;UNIX Time of Weather: &quot;</span>); Serial.<span class="built_in">println</span>(dt);</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Time of Weather: %4d-%02d-%02d %02d:%02d:%02d(%1d)\n&quot;</span>, <span class="built_in">year</span>(dt), <span class="built_in">month</span>(dt), <span class="built_in">day</span>(dt), <span class="built_in">hour</span>(dt), <span class="built_in">minute</span>(dt), <span class="built_in">second</span>(dt), <span class="built_in">weekday</span>(dt));</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Weather ID: &quot;</span>); Serial.<span class="built_in">println</span>(weather_0_id);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Weather Main: &quot;</span>); Serial.<span class="built_in">println</span>(weather_0_main);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Weather Description: &quot;</span>); Serial.<span class="built_in">println</span>(weather_0_description);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Weather Icon: &quot;</span>); Serial.<span class="built_in">println</span>(weather_0_icon);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Temperature(℃): &quot;</span>); Serial.<span class="built_in">println</span>(main_temp);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Temperature Max(℃): &quot;</span>); Serial.<span class="built_in">println</span>(main_temp_max);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Temperature Min(℃): &quot;</span>); Serial.<span class="built_in">println</span>(main_temp_min);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Pressure(hPa): &quot;</span>); Serial.<span class="built_in">println</span>(main_pressure);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Humidity(%): &quot;</span>); Serial.<span class="built_in">println</span>(main_humidity);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Visibility(m): &quot;</span>); Serial.<span class="built_in">println</span>(visibility);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Wind Speed(m/s): &quot;</span>); Serial.<span class="built_in">println</span>(wind_speed);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Wind Degree(º): &quot;</span>); Serial.<span class="built_in">println</span>(wind_deg);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Clouds: &quot;</span>); Serial.<span class="built_in">println</span>(clouds_all);</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Sunrise: %02d:%02d:%02d\n&quot;</span>, <span class="built_in">hour</span>(sys_sunrise), <span class="built_in">minute</span>(sys_sunrise), <span class="built_in">second</span>(sys_sunrise));</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Sunset:  %02d:%02d:%02d\n&quot;</span>, <span class="built_in">hour</span>(sys_sunset), <span class="built_in">minute</span>(sys_sunset), <span class="built_in">second</span>(sys_sunset));</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;City/Country: &quot;</span>); Serial.<span class="built_in">print</span>(name); Serial.<span class="built_in">print</span>(<span class="string">&quot;/&quot;</span>); Serial.<span class="built_in">println</span>(sys_country);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;longitude/latidude: &quot;</span>); Serial.<span class="built_in">print</span>(coord_lon); Serial.<span class="built_in">print</span>(<span class="string">&quot;/&quot;</span>); Serial.<span class="built_in">println</span>(coord_lat);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Timezone: GMT+&quot;</span>); Serial.<span class="built_in">println</span>(timezone/<span class="number">3600</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Sea Level(hPa): &quot;); Serial.println(main_sea_level);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Ground Level(hPa): &quot;); Serial.println(main_grnd_level);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Rain 1h(mm): &quot;); Serial.println(rain_1h);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Rain 3h(mm): &quot;); Serial.println(rain_3h);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Snow 1h(mm): &quot;); Serial.println(snow_1h);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Snow 3h(mm): &quot;); Serial.println(snow_3h);</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;Error on HTTP request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    http.<span class="built_in">end</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">30000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="출력-Data"><a href="#출력-Data" class="headerlink" title="출력 Data"></a>출력 Data</h4><p><img src="/image/owm-03.png"></p>
<br>

<br>

<h3 id="Weather-Condition-Code"><a href="#Weather-Condition-Code" class="headerlink" title="Weather Condition Code"></a>Weather Condition Code</h3><h4 id="Group-2xx-Thunderstorm"><a href="#Group-2xx-Thunderstorm" class="headerlink" title="Group 2xx: Thunderstorm"></a>Group 2xx: Thunderstorm</h4><table>
<thead>
<tr>
<th>ID</th>
<th>Main</th>
<th>Description</th>
<th>Icon</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>Thunderstorm</td>
<td>thunderstorm with light rain</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>201</td>
<td>Thunderstorm</td>
<td>thunderstorm with rain</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>202</td>
<td>Thunderstorm</td>
<td>thunderstorm with heavy rain</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>210</td>
<td>Thunderstorm</td>
<td>light thunderstorm</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>211</td>
<td>Thunderstorm</td>
<td>thunderstorm</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>212</td>
<td>Thunderstorm</td>
<td>heavy thunderstorm</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>221</td>
<td>Thunderstorm</td>
<td>ragged thunderstorm</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>230</td>
<td>Thunderstorm</td>
<td>thunderstorm with light drizzle</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>231</td>
<td>Thunderstorm</td>
<td>thunderstorm with drizzle</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
<tr>
<td>232</td>
<td>Thunderstorm</td>
<td>thunderstorm with heavy drizzle</td>
<td><img src="http://openweathermap.org/img/wn/11d@2x.png" alt="img"> 11d</td>
</tr>
</tbody></table>
<br>

<h4 id="Group-3xx-Drizzle"><a href="#Group-3xx-Drizzle" class="headerlink" title="Group 3xx: Drizzle"></a>Group 3xx: Drizzle</h4><table>
<thead>
<tr>
<th>ID</th>
<th>Main</th>
<th>Description</th>
<th>Icon</th>
</tr>
</thead>
<tbody><tr>
<td>300</td>
<td>Drizzle</td>
<td>light intensity drizzle</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>301</td>
<td>Drizzle</td>
<td>drizzle</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>302</td>
<td>Drizzle</td>
<td>heavy intensity drizzle</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>310</td>
<td>Drizzle</td>
<td>light intensity drizzle rain</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>311</td>
<td>Drizzle</td>
<td>drizzle rain</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>312</td>
<td>Drizzle</td>
<td>heavy intensity drizzle rain</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>313</td>
<td>Drizzle</td>
<td>shower rain and drizzle</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>314</td>
<td>Drizzle</td>
<td>heavy shower rain and drizzle</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>321</td>
<td>Drizzle</td>
<td>shower drizzle</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
</tbody></table>
<br>

<h4 id="Group-5xx-Rain"><a href="#Group-5xx-Rain" class="headerlink" title="Group 5xx: Rain"></a>Group 5xx: Rain</h4><table>
<thead>
<tr>
<th>ID</th>
<th>Main</th>
<th>Description</th>
<th>Icon</th>
</tr>
</thead>
<tbody><tr>
<td>500</td>
<td>Rain</td>
<td>light rain</td>
<td><img src="http://openweathermap.org/img/wn/10d@2x.png" alt="img"> 10d</td>
</tr>
<tr>
<td>501</td>
<td>Rain</td>
<td>moderate rain</td>
<td><img src="http://openweathermap.org/img/wn/10d@2x.png" alt="img"> 10d</td>
</tr>
<tr>
<td>502</td>
<td>Rain</td>
<td>heavy intensity rain</td>
<td><img src="http://openweathermap.org/img/wn/10d@2x.png" alt="img"> 10d</td>
</tr>
<tr>
<td>503</td>
<td>Rain</td>
<td>very heavy rain</td>
<td><img src="http://openweathermap.org/img/wn/10d@2x.png" alt="img"> 10d</td>
</tr>
<tr>
<td>504</td>
<td>Rain</td>
<td>extreme rain</td>
<td><img src="http://openweathermap.org/img/wn/10d@2x.png" alt="img"> 10d</td>
</tr>
<tr>
<td>511</td>
<td>Rain</td>
<td>freezing rain</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>520</td>
<td>Rain</td>
<td>light intensity shower rain</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>521</td>
<td>Rain</td>
<td>shower rain</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>522</td>
<td>Rain</td>
<td>heavy intensity shower rain</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
<tr>
<td>531</td>
<td>Rain</td>
<td>ragged shower rain</td>
<td><img src="http://openweathermap.org/img/wn/09d@2x.png" alt="img"> 09d</td>
</tr>
</tbody></table>
<br>

<h4 id="Group-6xx-Snow"><a href="#Group-6xx-Snow" class="headerlink" title="Group 6xx: Snow"></a>Group 6xx: Snow</h4><table>
<thead>
<tr>
<th>ID</th>
<th>Main</th>
<th>Description</th>
<th>Icon</th>
</tr>
</thead>
<tbody><tr>
<td>600</td>
<td>Snow</td>
<td>light snow</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>601</td>
<td>Snow</td>
<td>Snow</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>602</td>
<td>Snow</td>
<td>Heavy snow</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>611</td>
<td>Snow</td>
<td>Sleet</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>612</td>
<td>Snow</td>
<td>Light shower sleet</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>613</td>
<td>Snow</td>
<td>Shower sleet</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>615</td>
<td>Snow</td>
<td>Light rain and snow</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>616</td>
<td>Snow</td>
<td>Rain and snow</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>620</td>
<td>Snow</td>
<td>Light shower snow</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>621</td>
<td>Snow</td>
<td>Shower snow</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
<tr>
<td>622</td>
<td>Snow</td>
<td>Heavy shower snow</td>
<td><img src="http://openweathermap.org/img/wn/13d@2x.png" alt="img"> 13d</td>
</tr>
</tbody></table>
<br>

<h4 id="Group-7xx-Atmosphere"><a href="#Group-7xx-Atmosphere" class="headerlink" title="Group 7xx: Atmosphere"></a>Group 7xx: Atmosphere</h4><table>
<thead>
<tr>
<th>ID</th>
<th>Main</th>
<th>Description</th>
<th>Icon</th>
</tr>
</thead>
<tbody><tr>
<td>701</td>
<td>Mist</td>
<td>mist</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>711</td>
<td>Smoke</td>
<td>Smoke</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>721</td>
<td>Haze</td>
<td>Haze</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>731</td>
<td>Dust</td>
<td>sand/ dust whirls</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>741</td>
<td>Fog</td>
<td>fog</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>751</td>
<td>Sand</td>
<td>sand</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>761</td>
<td>Dust</td>
<td>dust</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>762</td>
<td>Ash</td>
<td>volcanic ash</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>771</td>
<td>Squall</td>
<td>squalls</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
<tr>
<td>781</td>
<td>Tornado</td>
<td>tornado</td>
<td><img src="http://openweathermap.org/img/wn/50d@2x.png" alt="img"> 50d</td>
</tr>
</tbody></table>
<br>

<h4 id="Group-800-Clear"><a href="#Group-800-Clear" class="headerlink" title="Group 800: Clear"></a>Group 800: Clear</h4><table>
<thead>
<tr>
<th>ID</th>
<th>Main</th>
<th>Description</th>
<th>Icon</th>
</tr>
</thead>
<tbody><tr>
<td>800</td>
<td>Clear</td>
<td>clear sky</td>
<td><img src="http://openweathermap.org/img/wn/01d@2x.png" alt="img"> 01d <img src="http://openweathermap.org/img/wn/01n@2x.png" alt="img"> 01n</td>
</tr>
</tbody></table>
<br>

<h4 id="Group-80x-Clouds"><a href="#Group-80x-Clouds" class="headerlink" title="Group 80x: Clouds"></a>Group 80x: Clouds</h4><table>
<thead>
<tr>
<th>ID</th>
<th>Main</th>
<th>Description</th>
<th>Icon</th>
</tr>
</thead>
<tbody><tr>
<td>801</td>
<td>Clouds</td>
<td>few clouds: 11-25%</td>
<td><img src="http://openweathermap.org/img/wn/02d@2x.png" alt="img"> 02d <img src="http://openweathermap.org/img/wn/02n@2x.png" alt="img"> 02n</td>
</tr>
<tr>
<td>802</td>
<td>Clouds</td>
<td>scattered clouds: 25-50%</td>
<td><img src="http://openweathermap.org/img/wn/03d@2x.png" alt="img"> 03d <img src="http://openweathermap.org/img/wn/03n@2x.png" alt="img"> 03n</td>
</tr>
<tr>
<td>803</td>
<td>Clouds</td>
<td>broken clouds: 51-84%</td>
<td><img src="http://openweathermap.org/img/wn/04d@2x.png" alt="img"> 04d <img src="http://openweathermap.org/img/wn/04n@2x.png" alt="img"> 04n</td>
</tr>
<tr>
<td>804</td>
<td>Clouds</td>
<td>overcast clouds: 85-100%</td>
<td><img src="http://openweathermap.org/img/wn/04d@2x.png" alt="img"> 04d <img src="http://openweathermap.org/img/wn/04n@2x.png" alt="img"> 04n</td>
</tr>
</tbody></table>
<br>

<h4 id="ICON-출력방법"><a href="#ICON-출력방법" class="headerlink" title="ICON 출력방법"></a>ICON 출력방법</h4><p>Weather ID 801에 해당하는 아이콘 code가 02d이므로 URL을 다음과 같이 지정하면</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://openweathermap.org/img/wn/10d.png</span><br></pre></td></tr></table></figure>

<p><img src="http://openweathermap.org/img/wn/10d.png"></p>
<p>ICON크기를 크게 출력하고 싶은 경우에는 아이콘 code에 <strong>@2x</strong>를 덧붙입니다.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://openweathermap.org/img/wn/10d@2x.png</span><br></pre></td></tr></table></figure>

<p><img src="http://openweathermap.org/img/wn/10d@2x.png"></p>
<br>

<br>

<h3 id="1602-LCD에-날씨-정보-출력하기"><a href="#1602-LCD에-날씨-정보-출력하기" class="headerlink" title="1602 LCD에 날씨 정보 출력하기"></a>1602 LCD에 날씨 정보 출력하기</h3><p>여러가지 날씨 정보 중에서 현재 온도를 1602 LCD(I2C)에 출력해보겠습니다.</p>
<br>

<h4 id="라이브러리-설치하기"><a href="#라이브러리-설치하기" class="headerlink" title="라이브러리 설치하기"></a>라이브러리 설치하기</h4><p><strong>스케치</strong>&gt; <strong>라이브러리 포함하기</strong>&gt; <strong>라이브러리 관리</strong></p>
<ul>
<li>LiquidCrystal I2C (by Frank de Brabander) 검색하여 설치</li>
</ul>
<br>

<h4 id="schematic"><a href="#schematic" class="headerlink" title="schematic"></a>schematic</h4><p><img src="/image/owm-06.png"></p>
<br>

<h4 id="sketch-1"><a href="#sketch-1" class="headerlink" title="sketch"></a>sketch</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;HTTPClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;TimeLib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ssid     = <span class="string">&quot;your ssid&quot;</span>;                  <span class="comment">// 연결할 SSID</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* password = <span class="string">&quot;your password&quot;</span>;              <span class="comment">// 연결할 SSID의 비밀번호</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> String endpoint = <span class="string">&quot;https://api.openweathermap.org&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> String ver = <span class="string">&quot;/data/2.5/weather?q=&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> String city = <span class="string">&quot;Shanghai,CN&quot;</span>;                 <span class="comment">// City,Country (띄어쓰기 금지)</span></span><br><span class="line"><span class="keyword">const</span> String appid = <span class="string">&quot;&amp;units=metric&amp;APPID=&quot;</span>;       <span class="comment">// Units: metric</span></span><br><span class="line"><span class="keyword">const</span> String key = <span class="string">&quot;1bf3d5e1bd2e5934aadd86..........&quot;</span>;    <span class="comment">// API Key</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> offset_days = <span class="number">3</span>;                            <span class="comment">// 3 days for convert unix timestamp to datetime</span></span><br><span class="line"><span class="keyword">float</span> main_temp;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set the LCD</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;LiquidCrystal_I2C.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> lcdColumns = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">int</span> lcdRows = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set LCD address, number of columns and rows</span></span><br><span class="line"><span class="comment">// if you don&#x27;t know your display address, run an I2C scanner sketch</span></span><br><span class="line"><span class="function">LiquidCrystal_I2C <span class="title">lcd</span><span class="params">(<span class="number">0x27</span>, lcdColumns, lcdRows)</span></span>;  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line"> </span><br><span class="line">  WiFi.<span class="built_in">begin</span>(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.<span class="built_in">status</span>() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Connecting to WiFi..&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;Connected to the WiFi network&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// initialize LCD</span></span><br><span class="line">  lcd.<span class="built_in">init</span>();</span><br><span class="line">  <span class="comment">// turn on LCD backlight                      </span></span><br><span class="line">  lcd.<span class="built_in">backlight</span>();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ((WiFi.<span class="built_in">status</span>() == WL_CONNECTED)) &#123;            <span class="comment">// Check the current connection status</span></span><br><span class="line"> </span><br><span class="line">    HTTPClient http;</span><br><span class="line"> </span><br><span class="line">    http.<span class="built_in">begin</span>(endpoint + ver + city + appid + key); <span class="comment">// Specify the URL</span></span><br><span class="line">    <span class="keyword">int</span> httpCode = http.<span class="built_in">GET</span>();                       <span class="comment">// Make the request</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;                              <span class="comment">// Check for the returning code</span></span><br><span class="line">      <span class="comment">// 데이터 파싱</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">size_t</span> capacity = <span class="built_in">JSON_ARRAY_SIZE</span>(<span class="number">1</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">1</span>) + <span class="number">2</span>*<span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">2</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">4</span>) + <span class="number">2</span>*<span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">5</span>) + <span class="built_in">JSON_OBJECT_SIZE</span>(<span class="number">13</span>) + <span class="number">270</span>;</span><br><span class="line">      <span class="function">DynamicJsonDocument <span class="title">doc</span><span class="params">(capacity)</span></span>;</span><br><span class="line"></span><br><span class="line">      String json = http.<span class="built_in">getString</span>();                <span class="comment">// get JSON format data</span></span><br><span class="line"></span><br><span class="line">      <span class="built_in">deserializeJson</span>(doc, json);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">float</span> coord_lon = doc[<span class="string">&quot;coord&quot;</span>][<span class="string">&quot;lon&quot;</span>]; <span class="comment">// 121.49</span></span><br><span class="line">      <span class="keyword">float</span> coord_lat = doc[<span class="string">&quot;coord&quot;</span>][<span class="string">&quot;lat&quot;</span>]; <span class="comment">// 31.23</span></span><br><span class="line"></span><br><span class="line">      JsonObject weather_0 = doc[<span class="string">&quot;weather&quot;</span>][<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">int</span> weather_0_id = weather_0[<span class="string">&quot;id&quot;</span>]; <span class="comment">// 804</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* weather_0_main = weather_0[<span class="string">&quot;main&quot;</span>]; <span class="comment">// &quot;Clouds&quot;</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* weather_0_description = weather_0[<span class="string">&quot;description&quot;</span>]; <span class="comment">// &quot;overcast clouds&quot;</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* weather_0_icon = weather_0[<span class="string">&quot;icon&quot;</span>]; <span class="comment">// &quot;04d&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      JsonObject weather_1 = weather[1];</span></span><br><span class="line"><span class="comment">      int weather_1_id = weather_1[&quot;id&quot;]; // 701</span></span><br><span class="line"><span class="comment">      const char* weather_1_main = weather_1[&quot;main&quot;]; // &quot;Mist&quot;</span></span><br><span class="line"><span class="comment">      const char* weather_1_description = weather_1[&quot;description&quot;]; // &quot;mist&quot;</span></span><br><span class="line"><span class="comment">      const char* weather_1_icon = weather_1[&quot;icon&quot;]; // &quot;50n&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      JsonObject weather_2 = weather[2];</span></span><br><span class="line"><span class="comment">      int weather_2_id = weather_2[&quot;id&quot;]; // 741</span></span><br><span class="line"><span class="comment">      const char* weather_2_main = weather_2[&quot;main&quot;]; // &quot;Fog&quot;</span></span><br><span class="line"><span class="comment">      const char* weather_2_description = weather_2[&quot;description&quot;]; // &quot;fog&quot;</span></span><br><span class="line"><span class="comment">      const char* weather_2_icon = weather_2[&quot;icon&quot;]; // &quot;50n&quot;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* base = doc[<span class="string">&quot;base&quot;</span>]; <span class="comment">// &quot;stations&quot;</span></span><br><span class="line"></span><br><span class="line">      JsonObject main = doc[<span class="string">&quot;main&quot;</span>];</span><br><span class="line">      <span class="keyword">float</span> main_temp = main[<span class="string">&quot;temp&quot;</span>]; <span class="comment">// 293.02</span></span><br><span class="line">      <span class="keyword">int</span> main_pressure = main[<span class="string">&quot;pressure&quot;</span>]; <span class="comment">// 1027</span></span><br><span class="line">      <span class="keyword">int</span> main_humidity = main[<span class="string">&quot;humidity&quot;</span>]; <span class="comment">// 55</span></span><br><span class="line">      <span class="keyword">float</span> main_temp_min = main[<span class="string">&quot;temp_min&quot;</span>]; <span class="comment">// 289.82</span></span><br><span class="line">      <span class="keyword">float</span> main_temp_max = main[<span class="string">&quot;temp_max&quot;</span>]; <span class="comment">// 298.71</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> visibility = doc[<span class="string">&quot;visibility&quot;</span>]; <span class="comment">// 10000</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> wind_speed = doc[<span class="string">&quot;wind&quot;</span>][<span class="string">&quot;speed&quot;</span>]; <span class="comment">// 3</span></span><br><span class="line">      <span class="keyword">int</span> wind_deg = doc[<span class="string">&quot;wind&quot;</span>][<span class="string">&quot;deg&quot;</span>]; <span class="comment">// 60</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> clouds_all = doc[<span class="string">&quot;clouds&quot;</span>][<span class="string">&quot;all&quot;</span>]; <span class="comment">// 94</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">long</span> dt = doc[<span class="string">&quot;dt&quot;</span>]; <span class="comment">// 1574303919</span></span><br><span class="line"></span><br><span class="line">      JsonObject sys = doc[<span class="string">&quot;sys&quot;</span>];</span><br><span class="line">      <span class="keyword">int</span> sys_type = sys[<span class="string">&quot;type&quot;</span>]; <span class="comment">// 1</span></span><br><span class="line">      <span class="keyword">int</span> sys_id = sys[<span class="string">&quot;id&quot;</span>]; <span class="comment">// 9659</span></span><br><span class="line">      <span class="comment">//float sys_message = sys[&quot;message&quot;]; // Internal parameter (0.0226)</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* sys_country = sys[<span class="string">&quot;country&quot;</span>]; <span class="comment">// &quot;CN&quot;</span></span><br><span class="line">      <span class="keyword">long</span> sys_sunrise = sys[<span class="string">&quot;sunrise&quot;</span>]; <span class="comment">// 1574288762</span></span><br><span class="line">      <span class="keyword">long</span> sys_sunset = sys[<span class="string">&quot;sunset&quot;</span>]; <span class="comment">// 1574326426</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> timezone = doc[<span class="string">&quot;timezone&quot;</span>]; <span class="comment">// 28800</span></span><br><span class="line">      <span class="keyword">long</span> id = doc[<span class="string">&quot;id&quot;</span>]; <span class="comment">// 1796236</span></span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* name = doc[<span class="string">&quot;name&quot;</span>]; <span class="comment">// &quot;Shanghai&quot;</span></span><br><span class="line">      <span class="keyword">int</span> cod = doc[<span class="string">&quot;cod&quot;</span>]; <span class="comment">// 200</span></span><br><span class="line"></span><br><span class="line">      dt = dt + timezone;                     <span class="comment">// for GMT+8 -&gt; +28800, for GMT+9 -&gt; +32400</span></span><br><span class="line">      sys_sunrise = sys_sunrise + timezone;</span><br><span class="line">      sys_sunset = sys_sunset + timezone;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//int main_sea_level = main[&quot;sea_level&quot;]; // Atmospheric pressure hPa on the sea level</span></span><br><span class="line">      <span class="comment">//int main_grnd_level = main[&quot;grnd_level&quot;]; // Atmospheric pressure hPa on the ground level     </span></span><br><span class="line">      <span class="comment">//int rain_1h = doc[&quot;rain&quot;][&quot;1h&quot;]; // Rain volume for the last 1 hour, mm</span></span><br><span class="line">      <span class="comment">//int rain_3h = doc[&quot;rain&quot;][&quot;3h&quot;]; // Rain volume for the last 3 hour, mm</span></span><br><span class="line">      <span class="comment">//int snow_1h = doc[&quot;snow&quot;][&quot;1h&quot;]; // Snow volume for the last 1 hour, mm</span></span><br><span class="line">      <span class="comment">//int snow_3h = doc[&quot;snow&quot;][&quot;3h&quot;]; // Snow volume for the last 3 hour, mm</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//데이터 출력</span></span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;UNIX Time of Weather: &quot;</span>); Serial.<span class="built_in">println</span>(dt);</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Time of Weather: %4d-%02d-%02d %02d:%02d:%02d(%1d)\n&quot;</span>, <span class="built_in">year</span>(dt), <span class="built_in">month</span>(dt), <span class="built_in">day</span>(dt), <span class="built_in">hour</span>(dt), <span class="built_in">minute</span>(dt), <span class="built_in">second</span>(dt), <span class="built_in">weekday</span>(dt));</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Weather ID: &quot;</span>); Serial.<span class="built_in">println</span>(weather_0_id);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Weather Main: &quot;</span>); Serial.<span class="built_in">println</span>(weather_0_main);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Weather Description: &quot;</span>); Serial.<span class="built_in">println</span>(weather_0_description);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Weather Icon: &quot;</span>); Serial.<span class="built_in">println</span>(weather_0_icon);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Temperature(℃): &quot;</span>); Serial.<span class="built_in">println</span>(main_temp);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Temperature Max(℃): &quot;</span>); Serial.<span class="built_in">println</span>(main_temp_max);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Temperature Min(℃): &quot;</span>); Serial.<span class="built_in">println</span>(main_temp_min);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Pressure(hPa): &quot;</span>); Serial.<span class="built_in">println</span>(main_pressure);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Humidity(%): &quot;</span>); Serial.<span class="built_in">println</span>(main_humidity);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Visibility(m): &quot;</span>); Serial.<span class="built_in">println</span>(visibility);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Wind Speed(m/s): &quot;</span>); Serial.<span class="built_in">println</span>(wind_speed);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Wind Degree(º): &quot;</span>); Serial.<span class="built_in">println</span>(wind_deg);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Clouds: &quot;</span>); Serial.<span class="built_in">println</span>(clouds_all);</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Sunrise: %02d:%02d:%02d\n&quot;</span>, <span class="built_in">hour</span>(sys_sunrise), <span class="built_in">minute</span>(sys_sunrise), <span class="built_in">second</span>(sys_sunrise));</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;Sunset:  %02d:%02d:%02d\n&quot;</span>, <span class="built_in">hour</span>(sys_sunset), <span class="built_in">minute</span>(sys_sunset), <span class="built_in">second</span>(sys_sunset));</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;City/Country: &quot;</span>); Serial.<span class="built_in">print</span>(name); Serial.<span class="built_in">print</span>(<span class="string">&quot;/&quot;</span>); Serial.<span class="built_in">println</span>(sys_country);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;longitude/latidude: &quot;</span>); Serial.<span class="built_in">print</span>(coord_lon); Serial.<span class="built_in">print</span>(<span class="string">&quot;/&quot;</span>); Serial.<span class="built_in">println</span>(coord_lat);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;Timezone: GMT+&quot;</span>); Serial.<span class="built_in">println</span>(timezone/<span class="number">3600</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Sea Level(hPa): &quot;); Serial.println(main_sea_level);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Ground Level(hPa): &quot;); Serial.println(main_grnd_level);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Rain 1h(mm): &quot;); Serial.println(rain_1h);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Rain 3h(mm): &quot;); Serial.println(rain_3h);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Snow 1h(mm): &quot;); Serial.println(snow_1h);</span></span><br><span class="line"><span class="comment">      Serial.print(&quot;Snow 3h(mm): &quot;); Serial.println(snow_3h);</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      lcd.<span class="built_in">setCursor</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.<span class="built_in">print</span>(<span class="string">&quot;Temperature : &quot;</span>);</span><br><span class="line">      lcd.<span class="built_in">setCursor</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      lcd.<span class="built_in">print</span>(main_temp);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;Error on HTTP request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    http.<span class="built_in">end</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">30000</span>);</span><br><span class="line">  </span><br><span class="line">  lcd.<span class="built_in">setCursor</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">  lcd.<span class="built_in">print</span>(<span class="string">&quot;                &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Arduino IDE에서 컴파일시 *””경고: 라이브러리 LiquidCrystal_I2C가 avr 아키텍처에서 실행되며 esp32아키텍처에서 실행되는 현재보드에서는 호환되지 않을 수 있습니다.””*라는 메세지가 나타나지만, LCD 출력에는 문제가 없습니다.</p>
</blockquote>
<br>

<br>

<h3 id="공공데이터-활용하기"><a href="#공공데이터-활용하기" class="headerlink" title="공공데이터 활용하기"></a>공공데이터 활용하기</h3><p>위의 방법을 응용하면 국가별, 관련 업체별로 제공되는 여러가지 공공데이터를 활용할 수 있습니다.</p>
<ul>
<li>대기질 관련 데이터 : <a target="_blank" rel="external nofollow noopener noreferrer" href="https://aqicn.org/api/">https://aqicn.org/api/</a></li>
<li>(한국)공공데이터포털 : <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.data.go.kr/">https://www.data.go.kr/</a></li>
<li>(미국)공공데이터포털 : <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.data.gov/">https://www.data.gov/</a></li>
</ul>
<p>그밖에 활용가능한 공공데이터가 어떤 것이 있는지, 살펴보세요~</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2019-10-23T12:33:48.000Z" title="2019. 10. 23. 오후 8:33:48">2019-10-23</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-11-16T07:03:02.710Z" title="2021. 11. 16. 오후 3:03:02">2021-11-16</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/esp32/">esp32</a></span><span class="level-item">4분안에 읽기 (약 674 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/23/ESP32-BLE-Blynk-Gauge/">esp32 BLE, Blynk Gauge</a></h1><div class="content"><h3 id="ESP32에서-Blynk로-센서값-보내기"><a href="#ESP32에서-Blynk로-센서값-보내기" class="headerlink" title="ESP32에서 Blynk로 센서값 보내기"></a>ESP32에서 Blynk로 센서값 보내기</h3><p>Blynk App의 GAUGE 위젯을 사용하여 ESP32에 연결된 Potentiometer의 저항값을 읽어 Blynk App에 전압(V), 저항(㏀) 값을 표시해본다. (ESP32 → Blynk App)</p>
<ul>
<li>  ESP32의 Potentiometer 값을 읽기 위해 BLYNK_READ(Vpin)을 사용한다.</li>
<li>  새로운 프로젝트를 만드는 경우, 새로운 auth token을 받아서 사용해야 한다.</li>
</ul>
<br>

<h4 id="schematic"><a href="#schematic" class="headerlink" title="schematic"></a>schematic</h4><p><img src="/image/blynk-adc-01.png"></p>
<br>

<h4 id="sketch"><a href="#sketch" class="headerlink" title="sketch"></a>sketch</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLYNK_PRINT Serial</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLYNK_USE_DIRECT_CONNECT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BlynkSimpleEsp32_BLE.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BLEDevice.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BLEServer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You should get Auth Token in the Blynk App.</span></span><br><span class="line"><span class="comment">// Go to the Project Settings (nut icon).</span></span><br><span class="line"><span class="keyword">char</span> auth[] = <span class="string">&quot;WUAeS6P57T3XNaIGyLK1-OUv........&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Potentiometer Pin</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PIN_POTENTIOMETER A0                       <span class="comment">// Potentiometer GPIO 36</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Resist, Voltage</span></span><br><span class="line"><span class="keyword">int</span> value_Potentiometer; </span><br><span class="line"><span class="keyword">int</span> value_R;</span><br><span class="line"><span class="keyword">float</span> value_V;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// Debug console</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;Waiting for connections...&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for Blynk </span></span><br><span class="line">  Blynk.setDeviceName(<span class="string">&quot;Blynk-t&quot;</span>);</span><br><span class="line">  Blynk.begin(auth);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  value_Potentiometer = analogRead(PIN_POTENTIOMETER);  <span class="comment">// 12bit ADC (0~4095)</span></span><br><span class="line">  value_V = <span class="built_in">map</span>(value_Potentiometer, <span class="number">0</span>, <span class="number">4095</span>, <span class="number">3300</span>, <span class="number">0</span>); <span class="comment">// 0~3300mV</span></span><br><span class="line">  value_R = <span class="built_in">map</span>(value_V, <span class="number">0</span>, <span class="number">3300</span>, <span class="number">10000</span>, <span class="number">0</span>);            <span class="comment">// 0~10kΩ</span></span><br><span class="line">  </span><br><span class="line">  Blynk.run();</span><br><span class="line">  </span><br><span class="line">  Serial.print(<span class="string">&quot;Resist : &quot;</span>); Serial.print(value_R); Serial.println(<span class="string">&quot;Ω&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Voltage: &quot;</span>); Serial.print(value_V); Serial.println(<span class="string">&quot;mV&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BLYNK_READ(V1)           <span class="comment">// ESP32 -&gt; widget virtual pin1</span></span><br><span class="line">&#123;</span><br><span class="line">  Blynk.virtualWrite(V1, value_R);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BLYNK_READ(V2)           <span class="comment">// ESP32 -&gt; widget virtual pin1</span></span><br><span class="line">&#123;</span><br><span class="line">  Blynk.virtualWrite(V2, value_V);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  Blynk에서 2개의 Gauge를 사용하기 위해 BLYNK)READ(Vpin)을 2번 사용한다.</li>
<li>  Blynk.virtualWrite(Vpin, value)를 통해 Blynk App의 Gauge 위젯에서 지정한 virtual pin에 value값을 표시한다.</li>
</ul>
<br>

<br>

<h3 id="Blynk-설정"><a href="#Blynk-설정" class="headerlink" title="Blynk 설정"></a>Blynk 설정</h3><ol>
<li>새로운 프로젝트를 생성한다.<ul>
<li>NAME : ESP32_Potentiometer</li>
<li>CHOOSE DEVICE : ESP32 Dev Board</li>
<li>CONNECTION TYPE : BLE</li>
</ul>
</li>
</ol>
<img src="/image/blynk-adc-02.png" style="zoom:33%;">

<br>

<ol start="2">
<li>이메일로 발송된 토큰을 복사한다.</li>
</ol>
<img src="/image/blynk-adc-03.png" style="zoom:33%;">

<br>

<ol start="3">
<li>+버튼을 눌러 위젯을 추가할 수 있는 화면으로 진입한다.</li>
</ol>
<img src="/image/blynk-adc-04.png" style="zoom:33%;">

<br>

<ol start="4">
<li>먼저 BLE 위젯을 선택하여 ESP32와 Blynk간의 통신 방법을 지정한다.</li>
</ol>
<img src="/image/blynk-adc-05.png" style="zoom:33%;">

<br>

<ol start="5">
<li>블루투스 모양의 위젯 버튼을 눌러 Blynk와의 통신을 준비한다.</li>
</ol>
<img src="/image/blynk-adc-06.png" style="zoom:33%;">

<br>

<ol start="6">
<li>Connect BLE device</li>
</ol>
<img src="/image/blynk-adc-07.png" style="zoom:33%;">

<br>

<ol start="7">
<li>연결하고자 하는 BLE 장비를 선택하면,</li>
</ol>
<img src="/image/blynk-adc-08.png" style="zoom:33%;">

<br>

<ol start="8">
<li>연결 확인!</li>
</ol>
<img src="/image/blynk-adc-09.png" style="zoom:33%;">

<br>

<ol start="9">
<li>+버튼을 눌러 출력 위젯 2개를 추가한다. (Gauge, Labeled value)</li>
</ol>
<img src="/image/blynk-adc-10.png" style="zoom:33%;">

<br>

<ol start="10">
<li>먼저 Gauge 위젯을 선택한다.</li>
</ol>
<img src="/image/blynk-adc-11.png" style="zoom:33%;">

<br>

<ol start="11">
<li>Gauge 위젯이 추가되면 육각형 모양의 아이콘을 눌러 GAUGE Setting 화면으로 진입한다.</li>
</ol>
<img src="/image/blynk-adc-12.png" style="zoom:33%;">

<br>

<img src="/image/blynk-adc-13.png" style="zoom:33%;">

<br>

<ol start="12">
<li>설정화면에서 다음 4가지를 설정한다.<ul>
<li>NAME : 저항</li>
<li>INPUT : V1, 0~1000</li>
<li>LABEL : (단위를 표시하기 위해) x10 Ohm 을 적는다.</li>
<li>READING RATE : 1sec (PUSH 위젯은 실행되지 않음)</li>
</ul>
</li>
</ol>
<img src="/image/blynk-adc-14.png" style="zoom:33%;">

<br>

<ol start="13">
<li>Labeled Value 위젯을 추가하고, 다음과 같이 설정한다.<ul>
<li>NAME : 저항</li>
<li>INPUT : V2, 0~3300</li>
<li>LABEL : (단위를 표시하기 위해) mV 를 적는다.</li>
<li>READING RATE : 1sec (PUSH 위젯은 실행되지 않음)</li>
</ul>
</li>
</ol>
<img src="/image/blynk-adc-15.png" style="zoom:33%;">

<br>

<ol start="14">
<li>상단의 뒤로가기 화살표를 눌러 프로젝트 바탕화면으로 돌아간다.</li>
</ol>
<img src="/image/blynk-adc-16.png" style="zoom:33%;">

<br>

<ol start="15">
<li>여기서 플레이버튼을 누르면,</li>
</ol>
<img src="/image/blynk-adc-17.png" style="zoom:33%;">

<br>

<p>저항과 전압의 측정이 시작된다. (시리얼 모니터에서도 관찰 가능)</p>
<img src="/image/blynk-adc-18.png" style="zoom:33%;">

<br>

<img src="/image/blynk-adc-19.png" style="zoom:33%;">

<br>

<ol start="16">
<li>가변 저항을 돌릴 때마다 저항과 전압이 바뀐다.</li>
</ol>
<img src="/image/blynk-adc-20.png" style="zoom:33%;">

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2019-10-22T14:55:21.000Z" title="2019. 10. 22. 오후 10:55:21">2019-10-22</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-11-16T07:05:28.348Z" title="2021. 11. 16. 오후 3:05:28">2021-11-16</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/esp32/">esp32</a></span><span class="level-item">5분안에 읽기 (약 762 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/22/ESP32-BLE-Blynk-Slider-PWM/">esp32 BLE, Blynk Slider (PWM)</a></h1><div class="content"><h3 id="ESP32와-Blynk에서의-PWM-사용"><a href="#ESP32와-Blynk에서의-PWM-사용" class="headerlink" title="ESP32와 Blynk에서의 PWM 사용"></a>ESP32와 Blynk에서의 PWM 사용</h3><p>Blynk app에서 Slider 위젯을 사용하여 App → ESP32로 PWM 신호를 보내 LED의 밝기를 조절해본다.</p>
<ul>
<li>  Blynk에서 Slider는 Virtual pin을 사용해야한다. (Digital핀을 선택하는 것이 불가능)</li>
<li>  Virtual pin을 사용하기 위해 BLYNK_WRITE(Vpin)을 사용한다.</li>
<li>  ESP32에서 PWM을 사용하기 위한 절차에 따라 코딩을 진행한다.</li>
</ul>
<br>

<h4 id="schematic"><a href="#schematic" class="headerlink" title="schematic"></a>schematic</h4><p><img src="../image/blynk-pwm-01.png"></p>
<p>※ LED모듈을 사용하는 경우 저항이 필요없다.</p>
<br>

<h4 id="sketch"><a href="#sketch" class="headerlink" title="sketch"></a>sketch</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLYNK_PRINT Serial</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLYNK_USE_DIRECT_CONNECT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BlynkSimpleEsp32_BLE.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BLEDevice.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BLEServer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You should get Auth Token in the Blynk App.</span></span><br><span class="line"><span class="comment">// Go to the Project Settings (nut icon).</span></span><br><span class="line"><span class="keyword">char</span> auth[] = <span class="string">&quot;rc77E7UrbQHhoLE-LV1Ajxz20k8eLBrk&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setting PWM properties</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEDC_FREQ        5000 <span class="comment">// Hz</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEDC_CHANNEL_0   0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEDC_RESOLUTION  12   <span class="comment">// 10bit (0~1023) 12bit(0~4095) 16bit(0~65535)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// led Pin</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> pin_ledR = <span class="number">19</span>;</span><br><span class="line">    </span><br><span class="line">BLYNK_WRITE(V5)           <span class="comment">// widget virtual pin5 -&gt; ESP32</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> value_V5 = param.asInt();</span><br><span class="line">  ledcWrite(LEDC_CHANNEL_0, value_V5);</span><br><span class="line">  Serial.print(<span class="string">&quot;V5 value: &quot;</span>); Serial.println(value_V5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// Debug console</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;Waiting for connections...&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// configure LED PWM functionalitites</span></span><br><span class="line">  ledcSetup(LEDC_CHANNEL_0, LEDC_FREQ, LEDC_RESOLUTION);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// attach the same channel to the GPIO to be controlled</span></span><br><span class="line">  ledcAttachPin(pin_ledR, LEDC_CHANNEL_0);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for Blynk </span></span><br><span class="line">  Blynk.setDeviceName(<span class="string">&quot;Blynk-t&quot;</span>);</span><br><span class="line">  Blynk.begin(auth);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Blynk.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="sketch-분석"><a href="#sketch-분석" class="headerlink" title="sketch 분석"></a>sketch 분석</h4><p>Button 위젯 사용을 위해 사용하였던 예제 sketch에 다음의 라인을 추가하여야 한다.</p>
<br>

<ol>
<li>LED가 연결되어 있는 ESP32 핀</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> pin_ledR = <span class="number">19</span>;</span><br></pre></td></tr></table></figure>

<br>

<ol start="2">
<li>Blynk App에서 ESP32로 신호를 보내는 Virtual 핀</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BLYNK_WRITE(V5) &#123;                          <span class="comment">// widget virtual pin(V5) -&gt; ESP32</span></span><br><span class="line">  <span class="keyword">int</span> value_V5 = param.asInt();            <span class="comment">// V5로 지정된 위젯의 값을 읽고</span></span><br><span class="line">  ledcWrite(LEDC_CHANNEL_0, value_V5);     <span class="comment">// PWM 채널0으로 보냄</span></span><br><span class="line">  Serial.print(<span class="string">&quot;V5 value: &quot;</span>); Serial.println(value_V5);     <span class="comment">// 시리얼모니터에 출력</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<ol start="3">
<li>LED에 PWM 신호 출력 (밝기 조절)</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// configure LED PWM functionalitites</span></span><br><span class="line">ledcSetup(LEDC_CHANNEL_0, LEDC_FREQ, LEDC_RESOLUTION);</span><br><span class="line"></span><br><span class="line"><span class="comment">// attach the same channel to the GPIO to be controlled</span></span><br><span class="line">ledcAttachPin(pin_ledR, LEDC_CHANNEL_0);</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Blynk-App-설정"><a href="#Blynk-App-설정" class="headerlink" title="Blynk App 설정"></a>Blynk App 설정</h3><ol>
<li>Button 위젯을 삭제한다. (그냥 두어도 관계없음)</li>
</ol>
<img src="../image/blynk-pwm-02.png" style="zoom:33%;">

<br>

<img src="../image/blynk-pwm-03.png" style="zoom:33%;">

<br>

<img src="../image/blynk-pwm-04.png" style="zoom:33%;">

<br>

<ol start="2">
<li>프로젝트 바탕화면에서 ⊕버튼을 누른 후, Slider 위젯을 추가한다.</li>
</ol>
<img src="../image/blynk-pwm-05.png" style="zoom:33%;">

<br>

<ol start="3">
<li>프로젝트 바탕화면의 Slider 위젯을 누른다.</li>
</ol>
<img src="../image/blynk-pwm-06.png" style="zoom:33%;">

<br>

<ol start="4">
<li>Slider 설정화면이 나오면,</li>
</ol>
<img src="../image/blynk-pwm-07.png" style="zoom:33%;">

<br>

<p>PIN을 누르고 사용할 Virual 핀을 선택한 뒤 OK버튼을 누른다. (여기서는 V5선택)</p>
<img src="../image/blynk-pwm-08.png" style="zoom:33%;">

<br>

<img src="../image/blynk-pwm-09.png" style="zoom:33%;">

<br>

<ol start="5">
<li>다음 3가지를 추가로 설정한다.<ul>
<li>OUTPUT 범위 : 0 ~ 4095 (12bit 사용시)</li>
<li>SEND ON RELEASE : OFF (OFF 선택시 Slide를 조절하는 즉시 실시간으로 출력값 반영되며, ON 선택시 Slide에서 손가락을 떼면 출력값이 반영된다.)</li>
<li>WRITE INTERVAL : SEND ON RELEASE를 OFF로 선택시 나타나며, 100ms가 가장 작은 값이다.</li>
</ul>
</li>
</ol>
<br>

<img src="../image/blynk-pwm-10.png" style="zoom:33%;">

<br>

<p>설정을 모두 마치면 상단의 뒤로가기 화살표를 눌러 프로젝트 바탕화면으로 돌아간다.</p>
<br>

<ol start="6">
<li>Slider 위젯을 1초이상 누르고 있으면 위젯의 위치와 크기를 조절할 수 있다. 위젯의 위치를 아래로 내리고 가로폭의 크기를 늘려본다.</li>
</ol>
<img src="../image/blynk-pwm-11.png" style="zoom:33%;">

<br>

<img src="../image/blynk-pwm-12.png" style="zoom:33%;">

<br>

<ol start="7">
<li>이제 플레이(▷) 버튼을 누르고 Slide를 조절해본다.</li>
</ol>
<img src="../image/blynk-pwm-13.png" style="zoom:33%;">

<br>

<p>Slide값에 따라 LED의 밝기가 조절된다.</p>
<img src="../image/blynk-pwm-14.png" style="zoom:33%;">

<br>

<img src="../image/blynk-pwm-15.png" style="zoom:33%;">

<br>

<ol start="8">
<li>Slider를 조절하는 동안 Arduino IDE의 시리얼 모니터값을 확인해볼 수 있다.</li>
</ol>
<p><img src="../image/blynk-pwm-16.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2019-10-21T14:12:58.000Z" title="2019. 10. 21. 오후 10:12:58">2019-10-21</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-11-16T06:52:29.991Z" title="2021. 11. 16. 오후 2:52:29">2021-11-16</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/esp32/">esp32</a></span><span class="level-item">9분안에 읽기 (약 1361 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/21/ESP32-BLE-Blynk-Button/">esp32 BLE, Blynk Button</a></h1><div class="content"><h3 id="Blynk를-처음-사용하는-경우"><a href="#Blynk를-처음-사용하는-경우" class="headerlink" title="Blynk를 처음 사용하는 경우"></a>Blynk를 처음 사용하는 경우</h3><h4 id="Blynk-라이브러리-설치하기"><a href="#Blynk-라이브러리-설치하기" class="headerlink" title="Blynk 라이브러리 설치하기"></a>Blynk 라이브러리 설치하기</h4><ol>
<li> docs.blynk.cc 접속 – Downloads – Blynk Library</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/blynkkk/blynk-library/releases/tag/v0.6.1">https://github.com/blynkkk/blynk-library/releases/tag/v0.6.1</a><ul>
<li>  Blynk_Release_v0.6.1.zip 다운로드</li>
</ul>
</li>
<li> 압축을 풀면 libraries, tools 폴더가 보임</li>
<li>이 두 폴더를 아두이노IDE의 기본 스케치북 위치로 복사하여 붙여넣기 함<ul>
<li>  기존의 libraries 폴더와 합쳐짐</li>
<li>기본 스케치북 위치 확인 방법<ul>
<li>  아두이노IDE – 파일 – 환경설정 – 설정탭 – 스케치북 위치</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>

<h4 id="스마트폰에-Blynk-App-설치하기"><a href="#스마트폰에-Blynk-App-설치하기" class="headerlink" title="스마트폰에 Blynk App 설치하기"></a>스마트폰에 Blynk App 설치하기</h4><ul>
<li>  아이폰 : 애플 앱스토어</li>
<li>  안드로이드 : 구글 플레이스토어</li>
</ul>
<br>

<br>

<h3 id="버튼-위젯을-이용한-LED-On-Off-하기"><a href="#버튼-위젯을-이용한-LED-On-Off-하기" class="headerlink" title="버튼 위젯을 이용한 LED On/Off 하기"></a>버튼 위젯을 이용한 LED On/Off 하기</h3><h4 id="schematic"><a href="#schematic" class="headerlink" title="schematic"></a>schematic</h4><p><img src="/image/blynk-01.png"></p>
<p>※ RGB LED 모듈을 사용하는 경우에는 저항을 연결하지 않는다.</p>
<br>

<h4 id="Blynk-설정"><a href="#Blynk-설정" class="headerlink" title="Blynk 설정"></a>Blynk 설정</h4><ol>
<li>Blynk App 실행</li>
</ol>
<img src="/image/blynk-02.png" style="zoom:33%;">

<br>

<ol start="2">
<li>Create New Account : 주로 사용하는 e-mail을 사용하여 계정 생성 (계정이 이미 생성되어 있는 경우에는 Log In)</li>
</ol>
<img src="/image/blynk-03.png" style="zoom:33%;">

<br>

<img src="/image/blynk-04.png" style="zoom:33%;">

<br>

<ol start="3">
<li>New Project 생성 : ESP32_LED</li>
</ol>
<img src="/image/blynk-05.png" style="zoom:33%;">

<br>

<ul>
<li>  프로젝트명 : ESP32_LED</li>
<li>  CHOOSE DEVICE : ESP32 Dev Board</li>
<li>  CONNECTION TYPE : BLE</li>
</ul>
<br>

<img src="/image/blynk-06.png" style="zoom:33%;">

<br>

<ol start="4">
<li>Create를 누르면 Blynk 가입시 계정으로 사용한 이메일로 Auth Token 발송된다.</li>
</ol>
<img src="/image/blynk-07.png" style="zoom:33%;">

<br>

<ol start="5">
<li>OK버튼을 누르면 프로젝트가 생성된다.</li>
</ol>
<img src="/image/blynk-08.png" style="zoom:33%;">

<br>

<ol start="6">
<li>컴퓨터를 사용하여 이메일 계정에 로그인 한 후, Auth Token을 복사한다. (복잡한 형태의 토큰을 코딩시 사용할 것이므로, 스마트폰인 아닌 컴퓨터에서 확인하여 복사하는 것이 좋다.)</li>
</ol>
<p><img src="/image/blynk-09.png"></p>
<br>

<ol start="7">
<li>Blynk 위젯 설정 : 생성된 프로젝트(ESP32_LED) 바탕화면으로 진입하면 Blynk App 상단의 초록색 메뉴바의 이름이 “ESP32_LED”로 바뀐다.</li>
</ol>
<img src="/image/blynk-10.png" style="zoom:33%;">

<br>

<p>만약, 아래와 같이 초록색 메뉴바의 이름이 “Blynk”로 되어있다면, 프로젝트 바탕화면으로 진입하지 못한 것이다. 이때에는 검은색 바탕화면의 “ESP32_LED”프로젝트명을 확인한 후 터치하면 해당프로젝트로 진입할 수 있다. 기존에 다른 프로젝트를 만들어 둔 적이 있다면 검은색 바탕화면의 프로젝트명이 “ESP32_LED”가 아닐 수도 있다. 이런 경우에는 스마트폰 화면을 좌우로 스크롤하여 프로젝트명을 변경한 후 진입한다.</p>
<img src="/image/blynk-11.png" style="zoom:33%;">

<br>

<ol start="8">
<li>프로젝트 바탕화면에서 ⊕버튼을 누른 후, Button 위젯과 BLE 위젯을 눌러 추가한다.</li>
</ol>
<img src="/image/blynk-12.png" style="zoom:33%;">

<br>

<img src="/image/blynk-13.png" style="zoom:33%;">

<br>

<img src="/image/blynk-14.png" style="zoom:33%;">

<br>

<ol start="9">
<li>프로젝트 바탕화면에 두개의 위젯이 표시된다.</li>
</ol>
<img src="/image/blynk-15.png" style="zoom:33%;">

<br>

<ol start="10">
<li>BUTTON 위젯을 누르면 Buttom Settings 화면이 나타난다. 여기서 PIN부분을 누른다.</li>
</ol>
<img src="/image/blynk-16.png" style="zoom:33%;">

<br>

<ol start="11">
<li>LED를 연결한 PIN을 선택한다. 여기서는 Digital GP19를 선택하였다.</li>
</ol>
<img src="/image/blynk-17.png" style="zoom:33%;">

<br>

<ol start="12">
<li>OK버튼을 누르면 OUTPUT 버튼이 GP19로 설정된다. Mode는 SWITCH로 설정한다.</li>
</ol>
<img src="/image/blynk-18.png" style="zoom:33%;">

<br>

<ol start="13">
<li>Blynk App 상단의 뒤로가기 버튼을 누른뒤 프로젝트 바탕화면으로 간다.</li>
</ol>
<img src="/image/blynk-19.png" style="zoom:33%;">

<br>

<h4 id="Blynk-연결하기"><a href="#Blynk-연결하기" class="headerlink" title="Blynk 연결하기"></a>Blynk 연결하기</h4><ol>
<li>Arduino IDE에서 예제를 로드한다. <strong>파일</strong>&gt; <strong>예제</strong>&gt; <strong>Blynk</strong>&gt; <strong>Boards_Bluetooth</strong>&gt; <strong>ESP32_BLE</strong></li>
</ol>
<p><img src="/image/blynk-20.png"></p>
<br>

<ol start="2">
<li>예제의 char auth[] = “YourAuthToken”; 부분을 찾아서 쌍따옴표 사이의 YourAuthToken을 지운 뒤, 이메일에서 복사한 AuthToken 붙여넣은 뒤, 다른 이름으로 저장한다.</li>
</ol>
<p><img src="/image/blynk-21.png"></p>
<br>

<p><img src="/image/blynk-22.png"></p>
<br>

<ol start="3">
<li>예제의 <strong>Blynk.setDeviceName(“Blynk”);</strong> 부분을 찾아 따옴표 안의 BLE Device 이름을 적당한 이름으로 바꿔준다. (※이름을 바꿔주지 않으면 주변의 다른 기기와 중복되어 오작동할 소지가 있으므로 반드시 다른 이름으로 바꿔주어야 한다.)</li>
</ol>
<p><img src="/image/blynk-23.png"></p>
<br>

<p>Device Name을 “Blynk-t”로 수정하였다.</p>
<p><img src="/image/blynk-24.png"></p>
<br>

<ol start="4">
<li>ESP32에 스케치를 업로드한다. (업로드 시간이 Arduino에 비해 오래 걸림)</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLYNK_PRINT Serial</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLYNK_USE_DIRECT_CONNECT</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BlynkSimpleEsp32_BLE.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BLEDevice.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;BLEServer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You should get Auth Token in the Blynk App.</span></span><br><span class="line"><span class="comment">// Go to the Project Settings (nut icon).</span></span><br><span class="line"><span class="keyword">char</span> auth[] = <span class="string">&quot;rc77E7UrbQHhoLE-LV1Ajxz.........&quot;</span>;    <span class="comment">// Edit Your Auth Token!!</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// Debug console</span></span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;Waiting for connections...&quot;</span>);</span><br><span class="line"></span><br><span class="line">  Blynk.setDeviceName(<span class="string">&quot;Blynk-t&quot;</span>);                     <span class="comment">// Edit Your ESP32 Name!!!</span></span><br><span class="line">  Blynk.begin(auth);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Blynk.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<p><img src="/image/blynk-25.png"></p>
<br>

<ol start="5">
<li>이제 스마트폰의 Bluetooth기능을 키고, 위의 코드에서 수정한 Device Name을 찾아 연결한다.</li>
</ol>
<img src="/image/blynk-26.png" style="zoom:33%;">

<br>

<img src="/image/blynk-27.png" style="zoom:33%;">

<br>

<ol start="6">
<li>Blynk App에서 BLE버튼(블루투스 아이콘 모양)을 누른다.</li>
</ol>
<img src="/image/blynk-28.png" style="zoom:33%;">

<br>

<ol start="7">
<li>Connect BLE device 버튼을 누른다.</li>
</ol>
<img src="/image/blynk-29.png" style="zoom:33%;">

<br>

<ol start="8">
<li>연결할 Device(여기서는 Blynk-t)를 선택하고 OK를 누른다.</li>
</ol>
<img src="/image/blynk-30.png" style="zoom:33%;">

<br>

<ol start="9">
<li>Connected 메세지가 나오면 연결 설정이 완료된 것이다.</li>
</ol>
<img src="/image/blynk-31.png" style="zoom:33%;">

<br>

<ol start="10">
<li>Blynk App 상단의 뒤로 돌아가기 버튼을 눌러 프로젝트 바탕화면으로 돌아간다.</li>
</ol>
<img src="/image/blynk-32.png" style="zoom:33%;">

<br>

<ol start="11">
<li>App 오른쪽 상단의 ▷(플레이버튼)버튼을 누른다.</li>
</ol>
<img src="/image/blynk-33.png" style="zoom:33%;">

<br>

<p>플레이버튼을 눌렀을 때, App상단에 빨간색 숫자1이 보이면 아직 연결이 되지 않았다는 것을 의미한다. 잠시 기다리면 빨간색 숫자1이 사라지고, 이 상태가 작동 준비가 완료된다.</p>
<img src="/image/blynk-34.png" style="zoom:33%;">

<br>

<ol start="12">
<li>현재 Button은 OFF 되어 있으며, 이에 따라 GPIO 19에 연결되어 있는 LED도 OFF되어 있다.</li>
</ol>
<img src="/image/blynk-35.png" style="zoom:33%;">

<br>

<ol start="13">
<li>Button을 누르면 ON 상태로 바뀌면서, LED가 ON 상태로 점등된다.</li>
</ol>
<img src="/image/blynk-36.png" style="zoom:33%;">

<br>

<ol start="14">
<li>다시 Button을 누르면 OFF 상태로 바뀌면서, LED가 OFF 상태로 소등된다.</li>
</ol>
<img src="/image/blynk-37.png" style="zoom:33%;">

<br>

<ol start="15">
<li>정지버튼을 누르면 플레이상태가 정지상태로 바뀌면서 프로젝트 바탕화면으로 돌아간다.</li>
</ol>
<img src="/image/blynk-38.png" style="zoom:33%;">

<br>

<img src="/image/blynk-39.png" style="zoom:33%;">

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2019-10-20T14:10:53.000Z" title="2019. 10. 20. 오후 10:10:53">2019-10-20</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-11-16T07:23:01.127Z" title="2021. 11. 16. 오후 3:23:01">2021-11-16</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/arduino/">arduino</a></span><span class="level-item">8분안에 읽기 (약 1220 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/20/Arduino-Bluetooth-Blynk/">Arduino, Bluetooth, Blynk</a></h1><div class="content"><h3 id="Blynk-설정"><a href="#Blynk-설정" class="headerlink" title="Blynk 설정"></a>Blynk 설정</h3><h4 id="Blynk-라이브러리-설치"><a href="#Blynk-라이브러리-설치" class="headerlink" title="Blynk 라이브러리 설치"></a>Blynk 라이브러리 설치</h4><ol>
<li> docs.blynk.cc 접속 – Downloads – Blynk Library</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/blynkkk/blynk-library/releases/tag/v0.6.1">https://github.com/blynkkk/blynk-library/releases/tag/v0.6.1</a><ul>
<li>  Blynk_Release_v0.6.1.zip 다운로드</li>
</ul>
</li>
<li> 압축을 풀면 libraries, tools 폴더가 보임</li>
<li>이 두 폴더를 아두이노IDE의 기본 스케치북 위치로 복사하여 붙여넣기 함<ul>
<li>  기존의 libraries 폴더와 합쳐짐</li>
<li>기본 스케치북 위치 확인 방법<ul>
<li>  아두이노IDE – 파일 – 환경설정 – 설정탭 – 스케치북 위치</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>

<h4 id="스마트폰에-Blynk-App-다운로드-하여-설치하기"><a href="#스마트폰에-Blynk-App-다운로드-하여-설치하기" class="headerlink" title="스마트폰에 Blynk App 다운로드 하여 설치하기"></a>스마트폰에 Blynk App 다운로드 하여 설치하기</h4><ul>
<li>  아이폰 : 애플 앱스토어</li>
<li>  안드로이드 : 구글 플레이스토어</li>
</ul>
<br>

<br>

<h3 id="버튼-위젯을-이용한-LED-On-Off-하기"><a href="#버튼-위젯을-이용한-LED-On-Off-하기" class="headerlink" title="버튼 위젯을 이용한 LED On/Off 하기"></a>버튼 위젯을 이용한 LED On/Off 하기</h3><h4 id="Blynk-계정생성-및-Auth-Token-받기"><a href="#Blynk-계정생성-및-Auth-Token-받기" class="headerlink" title="Blynk 계정생성 및 Auth Token 받기"></a>Blynk 계정생성 및 Auth Token 받기</h4><ol>
<li> Blynk App 실행</li>
<li> Create New Account : 주로 사용하는 e-mail을 사용하여 계정 생성</li>
<li>Blynk에서 New Project 생성<ul>
<li>아이폰용 MLT-BT05의 경우<ul>
<li>  Project Name 설정: BLE Test</li>
<li>  CHOOSE DEVICE: Arduino UNO</li>
<li>  CONNECTION TYPE: BLE</li>
<li>  설정 후 Create 버튼</li>
</ul>
</li>
<li>안드로이드용 HC-06의 경우<ul>
<li>  Project Name 설정: HC-06 Test</li>
<li>  CHOOSE DEVICE: Arduino UNO</li>
<li>  CONNECTION TYPE: Bluetooth</li>
<li>  설정 후 Create 버튼</li>
</ul>
</li>
</ul>
</li>
<li>Auth Token 확인<ul>
<li>  가입시 지정한 이메일로 로그인하여 토큰 확인</li>
<li>  (매우 복잡한 형태의) 토큰을 복사하여 코딩시 사용할 것이므로, 컴퓨터로 확인!</li>
<li>  스마트폰으로 확인하는 것은 무의미함</li>
</ul>
</li>
</ol>
<br>

<h4 id="Blynk-위젯-설정"><a href="#Blynk-위젯-설정" class="headerlink" title="Blynk 위젯 설정"></a>Blynk 위젯 설정</h4><ol>
<li>아이폰용 MLT-BT05를 사용할 경우<ul>
<li>  생성된 프로젝트(BLE Test) 바탕화면으로 진입하면 Blynk App 상단의 초록색 메뉴바의 이름이 BLE Test로 바뀜</li>
<li>  여기서 ⊕버튼 터치한 후 Button위젯과 BLE위젯 추가</li>
<li>추가된 BUTTON 위젯 선택 후 설정<ul>
<li>  OUTPUT: Select pin: Digital D13 / MODE: SWITCH</li>
</ul>
</li>
</ul>
</li>
<li>안드로이드용 HC-06를 사용할 경우<ul>
<li>  생성된 프로젝트(HC-06 Test) 바탕화면으로 진입하면 Blynk App 상단의 초록색 메뉴바의 이름이 HC-06 Test로 바뀜</li>
<li>  여기서 ⊕버튼 터치한 후 Button위젯과 Bluetooth위젯 추가</li>
<li>추가된 BUTTON 위젯 선택 후 설정<ul>
<li>  OUTPUT: Select pin: Digital D13 / MODE: SWITCH</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>

<h4 id="Blynk-연결하기"><a href="#Blynk-연결하기" class="headerlink" title="Blynk 연결하기"></a>Blynk 연결하기</h4><ol>
<li>아두이노 스케치 예제 불러오기<ul>
<li>  파일 – 예제 – Blynk – Boards_USB_Serial – Arduino_SoftwareSerial 선택</li>
<li>  예제의 char auth[] = “YourAuthToken”; 부분을 찾아서 쌍따옴표 사이의 YourAuthToken을 지운 뒤, 이메일에서 복사한 AuthToken 붙여넣기</li>
</ul>
</li>
<li> 아두이노 UNO에 스케치 업로드</li>
<li>스마트폰의 블루투스 기능을 키고,<ul>
<li>아이폰용 MLT-BT05의 경우<ul>
<li>  Bluetooth 모듈 설정에서 설정한 모듈ID 디바이스를 연결(예를 들어 MLT-BT05-<strong>T</strong>) (디폴트 연결PIN 123456)</li>
<li>  Blynk App에서 BLE버튼(블루투스 아이콘 모양) 터치 후 Connect BLE device 버튼을 누른 뒤,</li>
<li>  연결할 디바이스 MLT-BT05-T를 찾은 후 OK버튼 누름</li>
<li>  MLT-BT05-T connected 메시지가 나오면 연결 완료된 것임</li>
</ul>
</li>
<li>안드로이드용 HC-06의 경우<ul>
<li>  Bluetooth 모듈 설정에서 설정한 모듈ID 디바이스를 연결(예를 들어 HC-06-<strong>T</strong> 디바이스를 연결 (디폴트 연결PIN 1234)</li>
<li>  Blynk App에서 Bluetooth버튼(블루투스 아이콘 모양) 터치 후 Connect Bluetooth device 버튼을 누른 뒤,</li>
<li>  연결할 디바이스 HC-06-T를 찾은 후 OK버튼 누름</li>
<li>  HC-06-T connected 메시지가 나오면 연결 완료된 것임</li>
</ul>
</li>
</ul>
</li>
<li>Blynk App 상단의 뒤로 돌아가기 버튼을 누른 뒤, App 오른쪽 상단의 ▷(플레이버튼)버튼을 누름<ul>
<li>  App상단에 빨간색 숫자1이 보이면 아직 연결이 되지 않았다는 것을 의미함</li>
<li>  잠시 기다리면 빨간색 숫자1이 사라지고, 이 상태가 작동 준비가 완료된 것을 의미함</li>
</ul>
</li>
<li> BUTTON 아이콘을 눌러 ON/OFF → 아두이노 Built-in LED ON/OFF</li>
<li> Blynk App 오른쪽 상단의 □(정지버튼)을 누른 뒤, ⊕버튼 터치한 후 Text Input 위젯 추가</li>
</ol>
<br>

<br>


<h3 id="슬라이더-위젯을-이용한-LED-밝기-제어"><a href="#슬라이더-위젯을-이용한-LED-밝기-제어" class="headerlink" title="슬라이더 위젯을 이용한 LED 밝기 제어"></a>슬라이더 위젯을 이용한 LED 밝기 제어</h3><p>Built-in LED가 사용하는 13번핀은 PWM이 지원되지 않으므로, 11번핀을 사용한다.</p>
<p><img src="/image/BT-19.jpg"></p>
<br>

<h4 id="sketch"><a href="#sketch" class="headerlink" title="sketch"></a>sketch</h4><p>아두이노 스케치는 그대로 사용 (위의 “Blynk 연결하기” 부분 스케치 참고)</p>
<br>

<h4 id="Blynk-앱-설정"><a href="#Blynk-앱-설정" class="headerlink" title="Blynk 앱 설정"></a>Blynk 앱 설정</h4><ol>
<li> 버튼 위젯을 삭제: 버튼 위젯을 누르고 맨아래쪽으로 내려가서 Delete</li>
<li> Slider 위젯 추가: OUTPUT D11</li>
<li> Slider 위젯의 위치/크기 조절: Slider 위젯 아이콘을 1초이상 누르면 위치/크기를 조절할 수 있음 (가로 크기를 최대로 늘림)</li>
<li> App 오른쪽 상단의 ▷(플레이버튼)버튼을 누름</li>
<li> 슬라이드를 조절하여 LED의 밝기 조절 확인</li>
</ol>
<br>

<br>

<h3 id="과제"><a href="#과제" class="headerlink" title="과제"></a>과제</h3><p>3색 RGB LED를 zeRGBa 위젯으로 조정하여 여러 가지 색깔 만들어보기 (스케치는 위의 스케치를 그대로 사용)</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2019-10-18T14:46:21.000Z" title="2019. 10. 18. 오후 10:46:21">2019-10-18</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-11-16T06:44:53.570Z" title="2021. 11. 16. 오후 2:44:53">2021-11-16</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/arduino/">arduino</a></span><span class="level-item">8분안에 읽기 (약 1147 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/18/Blynk%EC%97%90-%EC%84%BC%EC%84%9C%EA%B0%92-%EC%B6%9C%EB%A0%A5%ED%95%98%EA%B8%B0/">Blynk에 센서값 출력하기</a></h1><div class="content"><p>원문: <a target="_blank" rel="external nofollow noopener noreferrer" href="http://help.blynk.cc/en/articles/512056-how-to-display-any-sensor-data-in-blynk-app">http://help.blynk.cc/en/articles/512056-how-to-display-any-sensor-data-in-blynk-app</a></p>
<br>

<p>센서값을 Blynk로 출력하기 위해서는 Blynk가 연결되지 않은 상태에서 시리얼모니터에 센서값들을 출력할 수 있어야 한다. ​센서값을 출력하는 코드가 완성되면, 그 다음으로 Blynk에 센서값을 보내는 작업을 시작하는 것이 좋다.</p>
<p>Blynk앱에 센서값을 표시하는 방법에는 크게 두가지 방법이 있으며, 진행중인 프로젝트에 따라 적절한 방법을 선택하면 된다.</p>
<br>

<h3 id="PULL"><a href="#PULL" class="headerlink" title="PULL"></a>PULL</h3><ul>
<li>  이 경우에 블링크는 앱이 열려있는 동안에만 Blynk에서 값을 받는다.</li>
<li>  앱에서 센서값을 표시하는 가장 간단한 방법이며, Blynk 앱의 Virtual Pins이 구동중일때 센서값을 가져온다. (Blynk를 닫거나 백그라운드에서 실행될때 데이타는 요청되지 않는다.) 타이머를 사용할 필요가 없으므로 코딩이 단순한 편이지만, 데이터가 서버에 저장되지 않으므로 히스토리 그래프를 볼 수 없다는 단점이 있다.</li>
</ul>
<br>

<h4 id="Blynk-앱-설정"><a href="#Blynk-앱-설정" class="headerlink" title="Blynk 앱 설정"></a>Blynk 앱 설정</h4><ol>
<li> 새 프로젝트를 만든다. (새로운 Auth Token값이 당신의 이메일에 전송된다)</li>
<li> Value Display 위젯을 추가한다.</li>
<li> 위젯 세팅으로 가서 PIN 항목을 Virtual Pin V5로 설정한다.</li>
<li> Reading Rate를 3초로 설정한다.</li>
</ol>
<br>

<h4 id="sketch"><a href="#sketch" class="headerlink" title="sketch"></a>sketch</h4><ol>
<li> Analog Pin에서 값을 (간단하게) 읽어들이는 경우에는 코드를 쓸 필요가 없다. 단지 예제파일을 오픈하여 하드웨어와 커넥션만 변경한다.</li>
<li> e-mail을 체크하여 Auth Token을 확인하고, 스케치에 Auth Token을 수정입력한다.</li>
<li> 하드웨어에 코드를 업로드한다.</li>
<li> Blynk에서 플레이버튼을 누른다.</li>
<li> 값이 표시되는 것을 볼 수 있다.</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BLYNK_READ(V5) &#123; <span class="comment">//Blynk app has something on V5</span></span><br><span class="line">  sensorData = analogRead(A0); <span class="comment">//reading the sensor on A0</span></span><br><span class="line">  Blynk.virtualWrite(V5, sensorData); <span class="comment">//sending to Blynk</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>이 코드는 매시간마다 Blynk가 <code>_READ</code> 요청을 Virtual Pin V5에 보내도록 한다. A0핀에서 센서값을 읽은 후, Blynk에서 Virtual Pin V5에 되돌려 준다.</p>
<br>

<br>

<h3 id="PUSH"><a href="#PUSH" class="headerlink" title="PUSH"></a>PUSH</h3><ul>
<li><p>이 경우 하드웨어(아두이노 or ESP32 등)는 Blynk가 오프라인 상태일때도 센서값을 Blynk 서버에 저장하고, 앱을 열어 온라인 상태가 되면 앱으로 전송하여 센서값을 보여준다.</p>
</li>
<li><p>Virtual Pin을 통하여 일정 주기로 하드웨어로부터 센서값을 전송하고, 이때마다 Blynk가 값을 받아들인다.</p>
</li>
</ul>
<p><img src="/image/blynk-sensor.png"></p>
<br>

<h4 id="주의할-점"><a href="#주의할-점" class="headerlink" title="주의할 점"></a>주의할 점</h4><p>void loop() 에서는 센서 값을 보낼 수 없다!!!</p>
<p>만약 void loop()문 내에 어떤 값을 넣게 되면 MCU가 아주 짧은 시간 간격으로 무한 반복하여 실행하게 되는데, Blynk는 인터넷을 통하여 값을 전송할 것이므로 Blynk 클라우드가 하드웨어로부터 오는 계속적인 데이터를 받게 될 것이다. Blynk 클라우드가 이러한 상황을 감지하면 자동적으로 접속을 끊게 된다.</p>
<p>그러므로 데이타를 일정 간격으로 보내야하며, 이를 위해 타이머를 사용하는 방법을 취한다. 일정간격으로 데이타를 보내는 방법에는 여러가지가 있지만, 가장 간단한 방법으로 BlynkTimer의 사용을 권장한다. BlynkTimer는 Blynk 라이브러리 패키지안에 포함되어 있으므로, Blynk 라이브러리만 제대로 설치되었다면 별도의 라이브러리를 설치하지 않아도 된다.</p>
<br>

<h4 id="Blynk-앱-설정-1"><a href="#Blynk-앱-설정-1" class="headerlink" title="Blynk 앱 설정"></a>Blynk 앱 설정</h4><ol>
<li> 새 프로젝트를 만든다. (새로운 Auth Token값이 당신의 이메일에 전송된다)</li>
<li> Value Display 위젯을 추가한다.</li>
<li> 위젯 세팅으로 가서 PIN 항목을 Virtual Pin V5로 설정한다.</li>
<li> Frequency를 PUSH로 설정한다.</li>
</ol>
<br>

<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><ol>
<li>timer라고 하는 BlynkTimer 오브젝트를 만든다.<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BlynkTimer timer; <span class="comment">// Announcing the timer</span></span><br></pre></td></tr></table></figure></li>
</ol>
<br>


<ol start="2">
<li>그 다음으로 일정 간격으로 실행하게 될 함수를 만든다. 이 함수는 A0에 연결된 센서로부터 값을 Virtual Pin V5를 통하여 전송한다.<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myTimerEvent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  sensorData = analogRead(A0);</span><br><span class="line">  Blynk.virtualWrite(V5, sensorData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<br>


<ol start="3">
<li>setup()문에서, 서브함수 myTimerEvent()가 매 1000ms, 즉 1초 간격으로 실행되도록 선언할 것이다.<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  timer.setInterval(<span class="number">1000L</span>, myTimerEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<br>


<ol start="4">
<li>loop문은 다음과 같이 설정한다.<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Blynk.run();</span><br><span class="line">  timer.run(); <span class="comment">// running timer every second</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2019-10-17T09:27:53.000Z" title="2019. 10. 17. 오후 5:27:53">2019-10-17</time>&nbsp;게시 됨</span><span class="level-item"><time datetime="2021-11-16T02:46:37.578Z" title="2021. 11. 16. 오전 10:46:37">2021-11-16</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/arduino/">arduino</a></span><span class="level-item">5분안에 읽기 (약 695 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/17/Bluetooth-%EC%8B%9C%EB%A6%AC%EC%96%BC-%ED%86%B5%EC%8B%A0/">Bluetooth Serial Controller 앱</a></h1><div class="content"><h1 id="Bluetooth-시리얼-통신"><a href="#Bluetooth-시리얼-통신" class="headerlink" title="Bluetooth 시리얼 통신"></a>Bluetooth 시리얼 통신</h1><p>Bluetooth Serial Controller 앱을 통하여 아두이노와 스마트폰 간의 간단한 시리얼 통신을 해보겠습니다. 이를 위해서는 먼저 <a href="2018/10/09/Arduino-Bluetooth-%ED%8E%98%EC%96%B4%EB%A7%81">Bluetooth 페어링</a> 문서를 참고하여 블루투스 모듈과 스마트폰을 페어링 해두어야 합니다. 페어링이 완료된 후 시리얼 통신을 진행합니다.</p>
<br>

<h2 id="schematic"><a href="#schematic" class="headerlink" title="schematic"></a>schematic</h2><p><img src="/image/BT-03.jpg"></p>
<br>

<h2 id="sketch"><a href="#sketch" class="headerlink" title="sketch"></a>sketch</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SoftwareSerial.h&gt;</span></span></span><br><span class="line"><span class="function">SoftwareSerial <span class="title">BTSerial</span><span class="params">(<span class="number">2</span>, <span class="number">3</span>)</span></span>; <span class="comment">//Connect HC-06 TX,RX </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">   Serial.begin(<span class="number">9600</span>);</span><br><span class="line">   Serial.println(<span class="string">&quot;Hello!&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set the data rate for the BT port</span></span><br><span class="line">   BTSerial.begin(<span class="number">9600</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (BTSerial.available())</span><br><span class="line">     Serial.write(BTSerial.read());</span><br><span class="line">   <span class="keyword">if</span> (Serial.available())</span><br><span class="line">     BTSerial.write(Serial.read());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="스마트폰에-Bluetooth-Serial-Controller-앱-설치하기"><a href="#스마트폰에-Bluetooth-Serial-Controller-앱-설치하기" class="headerlink" title="스마트폰에 Bluetooth Serial Controller 앱 설치하기"></a>스마트폰에 Bluetooth Serial Controller 앱 설치하기</h2><ol>
<li>이제 Google Playstore를 통해서 스마트폰에 Bluetooth Serial Controller 앱을 설치합니다. (iOS는 유사한 프로그램으로 설치)</li>
</ol>
<img src="/image/BTserialapp-01.png" style="zoom: 33%;">

<p>​    비슷한 역할을 하는 수많은 앱들이 있는데, 여러 앱을 설치하고 사용해본 결과, 이 앱이 사용하기에 유연함을 갖고 있는 것 같더군요.</p>
<br>

<p>​    설치되었습니다.</p>
<img src="/image/BTserialapp-02.png" style="zoom:33%;">

<br>

<ol start="2">
<li>설치 후 처음 실행을 하면, LANDSCAPE 모드(가로모드)로 실행이 되는데요. 그대로 사용해도 무방하지만 PORTRAIT 모드(세로 모드)로 바꿔보겠습니다. 먼저 PREFERENCE를 누르세요.</li>
</ol>
<img src="/image/BTserialapp-03.png" style="zoom:33%;">

<br>

<ol start="3">
<li>그러면 아래 화면이 뜹니다. 아무곳이나 누르고 위로 스크롤을 하면 아래에 숨겨져 있는 메뉴가 나타나게 되는데요.</li>
</ol>
<img src="/image/BTserialapp-04.png" style="zoom:33%;">

<br>

<ol start="4">
<li>OPTION - Orientation을 선택한 뒤,</li>
</ol>
<img src="/image/BTserialapp-05.png" style="zoom:33%;">

<br>

<ol start="5">
<li>PORTRAIT를 누릅니다.</li>
</ol>
<img src="/image/BTserialapp-06.png" style="zoom:33%;">

<br>

<ol start="6">
<li>이제 세로모드로 나타나요. 이제 HC-06모듈과 스마트폰과의 Serial 통신을 해보도록 하겠습니다. 다시 PREFERENCE를 누르고, TERMINAL MODE를 활성화 시키세요.</li>
</ol>
<img src="/image/BTserialapp-07.png" style="zoom:33%;">

<br>

<ol start="7">
<li>아래 화면이 TERMINAL Mode 화면입니다. 여기서 돋보기 모양을 누르고,</li>
</ol>
<img src="/image/BTserialapp-08.png" style="zoom:33%;">

<br>

<ol start="8">
<li>Paired Devices 목록에서 SKS100을 선택하세요. 그러면 TERMINAL이 HC-06에 접속하여, 서로간 통신할 수 있는 상태가 됩니다. </li>
</ol>
<img src="/image/BTserialapp-09.png" style="zoom:33%;">

<br>

<p>​    만일, 아래와 같이 Paired Devices 목록이 없으면, Scan for devices를 눌러 HC-06을 찾아보세요.</p>
<img src="/image/BTserialapp-10.png" style="zoom:33%;">

<br>

<ol start="9">
<li>TERMINAL이 SKS100에 접속을 시도합니다.</li>
</ol>
<img src="/image/BTserialapp-11.png" style="zoom:33%;">

<br>

<ol start="10">
<li>접속 완료!</li>
</ol>
<img src="/image/BTserialapp-12.png" style="zoom:33%;">

<br>

<h2 id="터미널과-Serial-통신하기"><a href="#터미널과-Serial-통신하기" class="headerlink" title="터미널과 Serial 통신하기"></a>터미널과 Serial 통신하기</h2><ol>
<li>이제 터미널 창에 Test를 입력하고 SEND를 눌러보세요.</li>
</ol>
<img src="/image/BTserialapp-13.png" style="zoom:33%;">

<br>

<ol start="2">
<li>그러면 화면에 Test가 출력됨과 동시에,</li>
</ol>
<img src="/image/BTserialapp-14.png" style="zoom:33%;">

<br>

<p>​     시리얼 모니터에 Test가 출력됩니다. 즉, TERMINAL에서 입력한 Test라는 글자가 HC-06을 통해, 아두이노와 연결되어 있는 컴퓨터의 시리얼 모니터에 출력된 것이에요.</p>
<p><img src="/image/BTserialapp-15.jpg"></p>
<br>

<ol start="3">
<li>이번에는 반대로 시리얼 모니터에 Good morning! 을 입력하고 전송을 누르면</li>
</ol>
<img src="/image/BTserialapp-16.png" style="zoom:33%;">

<br>

<p>​    스마트폰의 TERMINAL에 Good morning! 이 출력됩니다.</p>
<p><img src="/image/BTserialapp-17.jpg"></p>
</div></article></div></div><div class="column column-left is-3-tablet is-3-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-60x60 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="stemwith"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">stemwith</p><p class="is-size-6 is-block">de la Cruz a la fecha</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives"><p class="title">49</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags"><p class="title">3</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="external nofollow noopener noreferrer" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/esp32/"><span class="level-start"><span class="level-item">ESP32</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/science/"><span class="level-start"><span class="level-item">Science</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/arduino/"><span class="level-start"><span class="level-item">arduino</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/categories/diy/"><span class="level-start"><span class="level-item">diy</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/drone/"><span class="level-start"><span class="level-item">drone</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/esp32/"><span class="level-start"><span class="level-item">esp32</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/office/"><span class="level-start"><span class="level-item">office</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/science/"><span class="level-start"><span class="level-item">science</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">최근 글</h3><article class="media"><div class="media-content"><p class="date"><time datetime="2021-11-15T08:57:00.000Z">2021-11-15</time></p><p class="title"><a href="/2021/11/15/STEM-%EC%95%8C%EC%BD%94%EC%98%AC-%EB%9E%A8%ED%94%84-%EB%B0%9B%EC%B9%A8%EB%8C%80/">알코올램프 받침대 3D프린팅</a></p><p class="categories"><a href="/categories/science/">Science</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2021-11-15T08:57:00.000Z">2021-11-15</time></p><p class="title"><a href="/2021/11/15/%EC%95%8C%EC%BD%94%EC%98%AC%EB%9E%A8%ED%94%84-%EB%B0%9B%EC%B9%A8%EB%8C%80/">알코올램프 받침대 3D프린팅</a></p><p class="categories"><a href="/categories/science/">Science</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2021-11-02T08:57:00.000Z">2021-11-02</time></p><p class="title"><a href="/2021/11/02/STEM-%EC%A0%84%EC%9E%90%EA%B8%B0%ED%8C%8C-%EA%B2%80%EC%B6%9C%EA%B8%B0/">전자기파 검출기 만들기</a></p><p class="categories"><a href="/categories/science/">Science</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2021-11-01T09:27:53.000Z">2021-11-01</time></p><p class="title"><a href="/2021/11/01/ESP32-DC%EB%AA%A8%ED%84%B0/">ESP32, DC모터, TB6612FNG</a></p><p class="categories"><a href="/categories/esp32/">ESP32</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2021-10-10T09:27:53.000Z">2021-10-10</time></p><p class="title"><a href="/2021/10/10/ESP32-nRF24L01/">ESP32, nRF24L01 무선통신</a></p><p class="categories"><a href="/categories/esp32/">ESP32</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">아카이브</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">11월 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">10월 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">9월 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">11월 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">10월 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">8월 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">11월 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">10월 2019</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">9월 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">11월 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">10월 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">9월 2018</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">6월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">1월 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">11월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2012/10/"><span class="level-start"><span class="level-item">10월 2012</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">태그</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/3d/"><span class="tag">3D</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iot/"><span class="tag">iot</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rc/"><span class="tag">rc</span><span class="tag">4</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Welcome to &quot;stemwith&quot;" height="28"></a><p class="is-size-7"><span>&copy; 2021 chemidot</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="external nofollow noopener noreferrer">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="external nofollow noopener noreferrer" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "이 웹 사이트는 귀하의 경험을 향상시키기 위해 Cookie를 사용합니다.",
          dismiss: "무시",
          allow: "허용",
          deny: "거부",
          link: "더 알아보기",
          policy: "Cookie 정책",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>